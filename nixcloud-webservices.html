<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="nixcloud-webservices.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>nixcloud-webservices</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/nixcloud-webservices.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="33C3-nixos.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="nixcloud-webservices_tests.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  
      <div id="seriesContainer">
      <a href="timeline.html?filter=series::nixcloud" title="article series nixcloud" class="seriesbtn btn btn-primary">nixcloud</a>
        <header class="seriesHeader">
          <div id="seriesLeft"><a href="advanced_webservices_on_nixos_revisited.html"><span class="glyphiconLinkSeries glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article in series"></span>
            </a>   </div>
          <div id="seriesRight">   <a href="nixcloud-webservices_tests.html">
              <span class="glyphiconLinkSeries glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article in series"></span>
            </a></div>
        </header>
      </div>

  <div class="article">
    <h1 id="SiteTitle">nixcloud-webservices</h1>
    <div id="date"><p><span id="lastupdated">18 nov 2017</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::nlnet" class="tagbtn btn btn-primary">nlnet</a><a href="timeline.html?filter=tag::nixos" class="tagbtn btn btn-primary">nixos</a><a href="timeline.html?filter=tag::nixcloud" class="tagbtn btn btn-primary">nixcloud</a><a href="timeline.html?filter=tag::email" class="tagbtn btn btn-primary">email</a><a href="timeline.html?filter=tag::webservices" class="tagbtn btn btn-primary">webservices</a></p></div>
    <p><a href="media/nlnet-logo.gif"><img src=media/nlnet-logo.gif class="noFancy" style="float: right"></a></p>
<h2 data-number="1" id="motivation">motivation</h2>
<p>on the quest to make nix the no. 1 deployment tool for webservices,
we are happy to announce the release of:</p>
<ul>
<li><code>nixcloud.webservices</code></li>
<li><code>nixcloud.reverse-proxy</code></li>
<li><code>nixcloud.email</code></li>
</ul>
<p>all can be found online at:</p>
<pre><code>git clone https://github.com/nixcloud/nixcloud-webservices</code></pre>
<p>or visit: <a href="https://github.com/nixcloud/nixcloud-webservices"
class="uri">https://github.com/nixcloud/nixcloud-webservices</a></p>
<h2 data-number="2" id="nixcloud">nixcloud</h2>
<p>what is the nixcloud? paul and me (joachim) see the nixcloud as an
extension to nixpkgs focusing on the deployment of webservices. we
abstract installation, monitoring, DNS management and most of all ‘state
management’.</p>
<h2 data-number="3" id="nixcloud.webservices">nixcloud.webservices</h2>
<p><code>nixcloud.webservices</code> is a extension to nixpkgs for
packaging webservices (apache, nginx) or language specific
implementations as go, rust, perl and so on.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>nixcloud.webservices.leaps.myservice = <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">enable</span> <span class="op">=</span> <span class="cn">true</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">proxyOptions</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">port</span>   <span class="op">=</span> <span class="dv">50000</span><span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">path</span>   <span class="op">=</span> <span class="st">&quot;/foo&quot;</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">domain</span> <span class="op">=</span> <span class="st">&quot;example.com&quot;</span><span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>
<p>it comes with so many features and improvements that you are better
off reading the documentation here:</p>
<p><a
href="https://github.com/nixcloud/nixcloud-webservices/blob/master/documentation/nixcloud.webservices.md"
class="uri">https://github.com/nixcloud/nixcloud-webservices/blob/master/documentation/nixcloud.webservices.md</a></p>
<h2 data-number="4"
id="nixcloud.reverse-proxy">nixcloud.reverse-proxy</h2>
<p>this component makes it easy to mix several webservices, like
multiple webservers as apache or nginx, into one or several domains. it
also abstracts TLS using ACME.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>nixcloud.reverse<span class="op">-</span>proxy = <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">enable</span> <span class="op">=</span> <span class="cn">true</span><span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">extendEtcHosts</span> <span class="op">=</span> <span class="cn">true</span><span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">extraMappings</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="va">domain</span> <span class="op">=</span> <span class="st">&quot;example.com&quot;</span><span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="va">path</span> <span class="op">=</span> <span class="st">&quot;/&quot;</span><span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      <span class="va">http</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">mode</span> <span class="op">=</span> <span class="st">&quot;on&quot;</span><span class="op">;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">record</span> <span class="op">=</span> <span class="st">&#39;&#39;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">          rewrite ^(.*)$ https://example.org permanent;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">        &#39;&#39;</span><span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">};</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      <span class="va">https</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">mode</span> <span class="op">=</span> <span class="st">&quot;on&quot;</span><span class="op">;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">basicAuth</span>.<span class="st">&quot;joachim&quot;</span> <span class="op">=</span> <span class="st">&quot;foo&quot;</span><span class="op">;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">record</span> <span class="op">=</span> <span class="st">&#39;&#39;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="st">          rewrite ^(.*)$ https://example.org permanent;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="st">        &#39;&#39;</span><span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      <span class="op">};</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">];</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>
<p><a
href="https://github.com/nixcloud/nixcloud-webservices/blob/master/documentation/nixcloud.reverse-proxy.md"
class="uri">https://github.com/nixcloud/nixcloud-webservices/blob/master/documentation/nixcloud.reverse-proxy.md</a></p>
<h2 data-number="5" id="nixcloud.email">nixcloud.email</h2>
<p>manual here: <a
href="https://github.com/nixcloud/nixcloud-webservices/blob/master/documentation/nixcloud.email.md"
class="uri">https://github.com/nixcloud/nixcloud-webservices/blob/master/documentation/nixcloud.email.md</a></p>
<p>the idea is to make email deployment accessible to the masses by
providing an easy abstraction, especially for webhosting.</p>
<h3 data-number="5.1" id="configuration-example">configuration
example</h3>
<div class="sourceCode" id="cb4"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nixcloud.email= <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">enable</span> <span class="op">=</span> <span class="cn">true</span><span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">domains</span> <span class="op">=</span> <span class="op">[</span> <span class="st">&quot;example.com&quot;</span> <span class="st">&quot;example.org&quot;</span>  <span class="op">];</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">ipAddress</span> <span class="op">=</span> <span class="st">&quot;1.2.3.4&quot;</span><span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">ip6Address</span> <span class="op">=</span> <span class="st">&quot;afe2::2;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">  hostname = &quot;</span>example.com<span class="st">&quot;;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="st">  users = [</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="st">    # kdkdkdkdkdkd -&gt; feed that into -&gt; doveadm pw -s sha256-crypt</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="st">    { name = &quot;</span>js2<span class="st">&quot;; domain = &quot;</span>example.org<span class="st">&quot;; password = &quot;</span><span class="op">{</span><span class="va">PLAIN</span><span class="op">}</span>foobar1234<span class="st">&quot;; aliases = [ &quot;</span>postmaster@r0sset.com<span class="st">&quot; ]; }</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="st">    { name = &quot;</span>paul<span class="st">&quot;; domain = &quot;</span>example.com<span class="st">&quot;; password = &quot;</span><span class="op">{</span><span class="va">PLAIN</span><span class="op">}</span>supersupergeheim<span class="st">&quot;; }</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="st">    { name = &quot;</span>catchall<span class="st">&quot;; domain = &quot;</span>example.com<span class="st">&quot;; password = &quot;</span><span class="op">{</span><span class="va">PLAIN</span><span class="op">}</span>foobar1234<span class="st">&quot;; aliases = [ &quot;</span>@example.com<span class="st">&quot; ]; }</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="st">    #{ name = &quot;</span>js2<span class="st">&quot;; domain = &quot;</span>nix.lt<span class="st">&quot;; password = &quot;</span><span class="op">{</span><span class="va">PLAIN</span><span class="op">}</span>supersupergeheim<span class="st">&quot;; }</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="st">    #{ name = &quot;</span>quotatest<span class="st">&quot;; domain = &quot;</span>nix.lt<span class="st">&quot;; password = &quot;</span><span class="op">{</span><span class="va">PLAIN</span><span class="op">}</span>supersupergeheim<span class="st">&quot;; quota = &quot;</span>11M<span class="st">&quot;; aliases = [ &quot;</span>postmaster@mail.nix.lt<span class="st">&quot; &quot;</span>postmaster@nix.lt<span class="st">&quot; ]; }</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="st">  ];</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="st">};</span></span></code></pre></div>
<h2 data-number="6" id="questions">questions?</h2>
<ul>
<li>joachim schiele <a href="mailto:js@lastlog.de"
class="email">js@lastlog.de</a></li>
<li>paul seitz <a href="mailto:paul.m.seitz@gmail.com"
class="email">paul.m.seitz@gmail.com</a></li>
</ul>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/nixcloud-webservices.mdwn" title="posts\nixcloud-webservices.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
