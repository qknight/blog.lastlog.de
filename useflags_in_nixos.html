<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="useflags_in_nixos.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>useflags in nixos</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/useflags_in_nixos.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="playing_FTL_on_NIXOS.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="mediawiki-1.16-to-2.24.2_upgrade.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  

  <div class="article">
    <h1 id="SiteTitle">useflags in nixos</h1>
    <div id="date"><p><span id="lastupdated">13 apr 2015</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::gentoo" class="tagbtn btn btn-primary">gentoo</a><a href="timeline.html?filter=tag::nixos" class="tagbtn btn btn-primary">nixos</a><a href="timeline.html?filter=tag::nix" class="tagbtn btn btn-primary">nix</a></p></div>
    <p><a href="media/nixos-lores.png"><img src=media/nixos-lores.png alt="" class="noFancy" style="float: right"></a></p>
<h2 data-number="1" id="motivation">motivation</h2>
<p>gentoo linux has USE flags [1] and nixos has a very similar system.
in this short posting i want to show how they are used on nixos.</p>
<h2 data-number="2" id="about-use-flags">about USE flags</h2>
<p>for a very long time i was not even sure if nixos had USE flags at
all, since nix and nixos is so much different from all other linux
systems. but since i understand a lot more about nix/nixos now, i would
like to share my insights:</p>
<ul>
<li><strong>nix implements USE flags</strong></li>
<li>they are <strong>easy to use</strong>, see [2] for example</li>
<li>you can do <strong>even more with nix USE flags than you were able
in gentoo</strong></li>
</ul>
<p>note: there is a nice discussion here:</p>
<p><a href="https://github.com/NixOS/nixpkgs/issues/7446"
class="uri">https://github.com/NixOS/nixpkgs/issues/7446</a></p>
<h3 data-number="2.1" id="subversion-expression">subversion
expression</h3>
<p>you can find the source for the subversion nix expression at [4]:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>{ bdbSupport <span class="op">?</span> false <span class="op">#</span> build support for <span class="dt">Berkeley</span> <span class="dt">DB</span> repositories</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>, httpServer <span class="op">?</span> false <span class="op">#</span> build <span class="dt">Apache</span> <span class="dt">DAV</span> <span class="kw">module</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>, httpSupport <span class="op">?</span> false <span class="op">#</span> client must support http</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>, pythonBindings <span class="op">?</span> false</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>, perlBindings <span class="op">?</span> false</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>, javahlBindings <span class="op">?</span> false</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>, saslSupport <span class="op">?</span> false</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>, stdenv, fetchurl, apr, aprutil, zlib, sqlite</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>, apacheHttpd <span class="op">?</span> <span class="fu">null</span>, expat, swig <span class="op">?</span> <span class="fu">null</span>, jdk <span class="op">?</span> <span class="fu">null</span>, python <span class="op">?</span> <span class="fu">null</span>, perl <span class="op">?</span> <span class="fu">null</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>, sasl <span class="op">?</span> <span class="fu">null</span>, serf <span class="op">?</span> <span class="fu">null</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>}<span class="op">:</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>assert bdbSupport <span class="ot">-&gt;</span> aprutil<span class="op">.</span>bdbSupport;</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>assert httpServer <span class="ot">-&gt;</span> apacheHttpd <span class="op">!=</span> <span class="fu">null</span>;</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>assert pythonBindings <span class="ot">-&gt;</span> swig <span class="op">!=</span> <span class="fu">null</span> <span class="op">&amp;&amp;</span> python <span class="op">!=</span> <span class="fu">null</span>;</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>assert javahlBindings <span class="ot">-&gt;</span> jdk <span class="op">!=</span> <span class="fu">null</span> <span class="op">&amp;&amp;</span> perl <span class="op">!=</span> <span class="fu">null</span>;</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>stdenv<span class="op">.</span>mkDerivation (rec {</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  version <span class="ot">=</span> <span class="st">&quot;1.8.13&quot;</span>;</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">=</span> <span class="st">&quot;subversion-${version}&quot;</span>;</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  src <span class="ot">=</span> fetchurl {</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">=</span> <span class="st">&quot;mirror://apache/subversion/${name}.tar.bz2&quot;</span>;</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    sha1 <span class="ot">=</span> <span class="st">&quot;aa0bd14ac6a8f0fb178cc9ff325387de01cd7452&quot;</span>;</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  };</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  buildInputs <span class="ot">=</span> [ zlib apr aprutil sqlite ]</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">++</span> stdenv<span class="op">.</span>lib<span class="op">.</span>optional httpSupport serf</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">++</span> stdenv<span class="op">.</span>lib<span class="op">.</span>optional pythonBindings python</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">++</span> stdenv<span class="op">.</span>lib<span class="op">.</span>optional perlBindings perl</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">++</span> stdenv<span class="op">.</span>lib<span class="op">.</span>optional saslSupport sasl;</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  configureFlags <span class="ot">=</span> &#39;&#39;</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">$</span>{<span class="kw">if</span> bdbSupport <span class="kw">then</span> <span class="st">&quot;--with-berkeley-db&quot;</span> <span class="kw">else</span> <span class="st">&quot;--without-berkeley-db&quot;</span>}</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">$</span>{<span class="kw">if</span> httpServer <span class="kw">then</span> <span class="st">&quot;--with-apxs=${apacheHttpd}/bin/apxs&quot;</span> <span class="kw">else</span> <span class="st">&quot;--without-apxs&quot;</span>}</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">$</span>{<span class="kw">if</span> pythonBindings <span class="op">||</span> perlBindings <span class="kw">then</span> <span class="st">&quot;--with-swig=${swig}&quot;</span> <span class="kw">else</span> <span class="st">&quot;--without-swig&quot;</span>}</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">$</span>{<span class="kw">if</span> javahlBindings <span class="kw">then</span> <span class="st">&quot;--enable-javahl --with-jdk=${jdk}&quot;</span> <span class="kw">else</span> <span class="st">&quot;&quot;</span>}</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">$</span>{<span class="kw">if</span> stdenv<span class="op">.</span>isDarwin <span class="kw">then</span> <span class="st">&quot;--enable-keychain&quot;</span> <span class="kw">else</span> <span class="st">&quot;--disable-keychain&quot;</span>}</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">$</span>{<span class="kw">if</span> saslSupport <span class="kw">then</span> <span class="st">&quot;--with-sasl=${sasl}&quot;</span> <span class="kw">else</span> <span class="st">&quot;--without-sasl&quot;</span>}</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">$</span>{<span class="kw">if</span> httpSupport <span class="kw">then</span> <span class="st">&quot;--with-serf=${serf}&quot;</span> <span class="kw">else</span> <span class="st">&quot;--without-serf&quot;</span>}</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">--with-zlib=${zlib}</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">--with-sqlite=${sqlite}</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  &#39;&#39;;</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  preBuild <span class="ot">=</span> &#39;&#39;</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    makeFlagsArray<span class="ot">=</span>(<span class="dt">APACHE_LIBEXECDIR</span><span class="op">=$</span>out<span class="op">/</span>modules)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  &#39;&#39;;</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  postInstall <span class="ot">=</span> &#39;&#39;</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> test <span class="op">-</span>n <span class="st">&quot;$pythonBindings&quot;</span>; <span class="kw">then</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        make swig<span class="op">-</span>py swig_pydir<span class="op">=$</span>(toPythonPath <span class="op">$</span>out)<span class="op">/</span>libsvn swig_pydir_extra<span class="op">=$</span>(toPythonPath <span class="op">$</span>out)<span class="op">/</span>svn</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        make install<span class="op">-</span>swig<span class="op">-</span>py swig_pydir<span class="op">=$</span>(toPythonPath <span class="op">$</span>out)<span class="op">/</span>libsvn swig_pydir_extra<span class="op">=$</span>(toPythonPath <span class="op">$</span>out)<span class="op">/</span>svn</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    fi</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> test <span class="op">-</span>n <span class="st">&quot;$perlBindings&quot;</span>; <span class="kw">then</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        make swig<span class="op">-</span>pl<span class="op">-</span>lib</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        make install<span class="op">-</span>swig<span class="op">-</span>pl<span class="op">-</span>lib</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        cd subversion<span class="op">/</span>bindings<span class="op">/</span>swig<span class="op">/</span>perl<span class="op">/</span>native</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        perl <span class="dt">Makefile.PL</span> <span class="dt">PREFIX</span><span class="op">=$</span>out</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        make install</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        cd <span class="op">-</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    fi</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    mkdir <span class="op">-</span>p <span class="op">$</span>out<span class="op">/</span>share<span class="op">/</span>bash<span class="op">-</span>completion<span class="op">/</span>completions</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    cp tools<span class="op">/</span>client<span class="op">-</span>side<span class="op">/</span>bash_completion <span class="op">$</span>out<span class="op">/</span>share<span class="op">/</span>bash<span class="op">-</span>completion<span class="op">/</span>completions<span class="op">/</span>subversion</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  &#39;&#39;;</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  inherit perlBindings pythonBindings;</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  enableParallelBuilding <span class="ot">=</span> true;</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  meta <span class="ot">=</span> {</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    description <span class="ot">=</span> <span class="st">&quot;A version control system intended to be a compelling replacement for CVS in the open source community&quot;</span>;</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    homepage <span class="ot">=</span> http<span class="op">://</span>subversion<span class="op">.</span>apache<span class="op">.</span>org<span class="op">/</span>;</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    maintainers <span class="ot">=</span> with stdenv<span class="op">.</span>lib<span class="op">.</span>maintainers; [ eelco lovek323 ];</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    hydraPlatforms <span class="ot">=</span> stdenv<span class="op">.</span>lib<span class="op">.</span>platforms<span class="op">.</span>linux <span class="op">++</span> stdenv<span class="op">.</span>lib<span class="op">.</span>platforms<span class="op">.</span>darwin;</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  };</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>} <span class="op">//</span> stdenv<span class="op">.</span>lib<span class="op">.</span>optionalAttrs stdenv<span class="op">.</span>isDarwin {</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  <span class="dt">CXX</span> <span class="ot">=</span> <span class="st">&quot;clang++&quot;</span>;</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>  <span class="dt">CC</span> <span class="ot">=</span> <span class="st">&quot;clang&quot;</span>;</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  <span class="dt">CPP</span> <span class="ot">=</span> <span class="st">&quot;clang -E&quot;</span>;</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="dt">CXXCPP</span> <span class="ot">=</span> <span class="st">&quot;clang++ -E&quot;</span>;</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>this subversion nix expression can be customized depending on the
values provided on the function call. just see the two examples
below.</p>
<h3 data-number="2.2" id="example-1-usage">example 1 (usage)</h3>
<p><strong>example usage of the subversion expression</strong> [5] -
pkgs/top-level/all-packages.nix:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>apacheHttpdPackagesFor <span class="ot">=</span> apacheHttpd<span class="op">:</span> self<span class="op">:</span> <span class="kw">let</span> callPackage <span class="ot">=</span> newScope self; <span class="kw">in</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  inherit apacheHttpd;</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  mod_dnssd <span class="ot">=</span> callPackage <span class="op">../</span>servers<span class="op">/</span>http<span class="op">/</span>apache<span class="op">-</span>modules<span class="op">/</span>mod_dnssd { };</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  mod_evasive <span class="ot">=</span> callPackage <span class="op">../</span>servers<span class="op">/</span>http<span class="op">/</span>apache<span class="op">-</span>modules<span class="op">/</span>mod_evasive { };</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  mod_fastcgi <span class="ot">=</span> callPackage <span class="op">../</span>servers<span class="op">/</span>http<span class="op">/</span>apache<span class="op">-</span>modules<span class="op">/</span>mod_fastcgi { };</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  mod_python <span class="ot">=</span> callPackage <span class="op">../</span>servers<span class="op">/</span>http<span class="op">/</span>apache<span class="op">-</span>modules<span class="op">/</span>mod_python { };</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  mod_wsgi <span class="ot">=</span> callPackage <span class="op">../</span>servers<span class="op">/</span>http<span class="op">/</span>apache<span class="op">-</span>modules<span class="op">/</span>mod_wsgi { };</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  php <span class="ot">=</span> pkgs<span class="op">.</span>php<span class="op">.</span>override { inherit apacheHttpd; };</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  subversion <span class="ot">=</span> pkgs<span class="op">.</span>subversion<span class="op">.</span>override { httpServer <span class="ot">=</span> true; inherit apacheHttpd; };</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>};</span></code></pre></div>
<p>when the attribute <strong>apacheHttpdPackagesFor</strong> is
evaluated it will be passed all the function arguments shown above as
mod_dnssd, mod_evasive, …, and subversion. the main difference is that
it passes a specially crafted version of the subversion expression with
<strong>httpServer = true</strong> set;</p>
<h3 data-number="2.3" id="example-2-usage">example 2 (usage)</h3>
<p><strong>example usage of the subversion expression [6]</strong> -
pkgs/top-level/all-packages.nix:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>subversion <span class="ot">=</span> callPackage <span class="op">../</span>applications<span class="op">/</span>version<span class="op">-</span>management<span class="op">/</span>subversion<span class="op">/</span>default<span class="op">.</span>nix {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  bdbSupport <span class="ot">=</span> true;</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  httpServer <span class="ot">=</span> false;</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  httpSupport <span class="ot">=</span> true;</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  pythonBindings <span class="ot">=</span> false;</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  perlBindings <span class="ot">=</span> false;</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  javahlBindings <span class="ot">=</span> false;</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  saslSupport <span class="ot">=</span> false;</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  sasl <span class="ot">=</span> cyrus_sasl;</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>};</span></code></pre></div>
<p>if the attribute <strong>subversion</strong> is evaluated, say by
using:</p>
<pre><code>$ nix-env -i subversion</code></pre>
<p>then it won’t enable httpServer as it is disabled by default. if
both, example 1 and example 2 are used on the same system, this means
that two different versions of subversion are installed. this is a major
difference to gentoo, where you could have such a feature only by using
SLOS.</p>
<h2 data-number="3" id="conclusion">conclusion</h2>
<p>with nixos USE flags and assertions you can do everything what gentoo
linux provided and more. there are many good examples for their usage in
nixpkgs [3] already.</p>
<p>if you would use example 1 and example 2 on the same machine, then it
would install subversion two times on the same host. however, if both
function calls are equal it will use the same subversion binary twice
which happens if two users install subversion in their profile
using:</p>
<pre><code>$ nix-env -i subversion</code></pre>
<p>for instance.</p>
<h2 data-number="4" id="links">links</h2>
<ul>
<li>[1] <a href="https://wiki.gentoo.org/wiki/Handbook:X86/Working/USE"
class="uri">https://wiki.gentoo.org/wiki/Handbook:X86/Working/USE</a></li>
<li>[2] <a href="https://nixos.org/nix/manual/#ex-subversion-nix"
class="uri">https://nixos.org/nix/manual/#ex-subversion-nix</a></li>
<li>[3] <a href="https://github.com/nixos/nixpkgs"
class="uri">https://github.com/nixos/nixpkgs</a></li>
<li>[4] <a
href="https://github.com/NixOS/nixpkgs/blob/e01c96d14c356ec035774d5b5b74c533d1ceaf3e/pkgs/applications/version-management/subversion/default.nix"
class="uri">https://github.com/NixOS/nixpkgs/blob/e01c96d14c356ec035774d5b5b74c533d1ceaf3e/pkgs/applications/version-management/subversion/default.nix</a></li>
<li>[5] <a
href="https://github.com/NixOS/nixpkgs/blob/e01c96d14c356ec035774d5b5b74c533d1ceaf3e/pkgs/top-level/all-packages.nix#L8200"
class="uri">https://github.com/NixOS/nixpkgs/blob/e01c96d14c356ec035774d5b5b74c533d1ceaf3e/pkgs/top-level/all-packages.nix#L8200</a></li>
<li>[6] <a
href="https://github.com/NixOS/nixpkgs/blob/e01c96d14c356ec035774d5b5b74c533d1ceaf3e/pkgs/top-level/all-packages.nix#L11907"
class="uri">https://github.com/NixOS/nixpkgs/blob/e01c96d14c356ec035774d5b5b74c533d1ceaf3e/pkgs/top-level/all-packages.nix#L11907</a></li>
</ul>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/useflags_in_nixos.mdwn" title="posts\useflags_in_nixos.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
