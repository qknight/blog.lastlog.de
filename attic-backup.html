<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="attic-backup.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>attic-backup</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/attic-backup.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="ODOO_evaluation.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="playing_FTL_on_NIXOS.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  

  <div class="article">
    <h1 id="SiteTitle">attic-backup</h1>
    <div id="date"><p><span id="lastupdated">19 mar 2015</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::backup" class="tagbtn btn btn-primary">backup</a><a href="timeline.html?filter=tag::python" class="tagbtn btn btn-primary">python</a><a href="timeline.html?filter=tag::linux" class="tagbtn btn btn-primary">linux</a><a href="timeline.html?filter=tag::technology" class="tagbtn btn btn-primary">technology</a><a href="timeline.html?filter=tag::usability" class="tagbtn btn btn-primary">usability</a></p></div>
    <p><a href="media/attic-backup.jpg"><img src=media/attic-backup.jpg size=200x alt="" style="float: right" class="noFancy"></a></p>
<h2 data-number="1" id="motivation">motivation</h2>
<p>i do mysql backups using mysqldump and then move this into
rdiff-backup, rsnapshot or duplicity.</p>
<p>turns out attic [1] is a much better alternative!</p>
<h2 data-number="2" id="using-attic-for-mysql-backups">using attic for
mysql backups</h2>
<p>my script produces a mysqldump every night for all databases and
stores it in a single tar.bz2 file each so:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> du <span class="at">-sh</span> backups-extracted  <span class="co"># about 230 tar-archives (uncompressed)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">7.8G</span>    backups-extracted</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> du <span class="at">-sh</span> backups <span class="co"># about 230 tar-archives (each bz2 compressed)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">702M</span>    backups</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-lath</span> backups-extracted.tar.bz2 <span class="co"># about 230 tar-archives (compressed into a single bz2)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">713M</span> backups-extracted.tar.bz2</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> du <span class="at">-sh</span> attic <span class="co"># about 230 tar-archives (added into attic)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">105M</span>    attic</span></code></pre></div>
<p><strong>this is an outstanding result</strong> and to check if attic
didn’t scramble any bits i restored the backup and used ‘diff -r dir1
dir2’ and diff didn’t report any difference.</p>
<p>note: the databases are very idle and there is no change most of the
time.</p>
<h2 data-number="3" id="dans-experiments">dan’s experiments</h2>
<p>some stats for normal backups can be found at [2] so i quote what Dan
wrote:</p>
<blockquote>
<p>Obnam and Attic are two de-duplicating backup programs that seem to
have a very similar design, so I’ve been comparing them. Here are my
observations and benchmarks. I would be happy to receive corrections and
or additions to this information. The Attic author has also written
about this at</p>
</blockquote>
<pre class="shell"><code>Important question:

How resilient are the repositories that Obnam and Attic use?  If a
single sector fails on the hard-drive, how much will be lost?  Do the
programs deal with read errors without crashing?

Testing:

Versions used:  Attic 0.10, Obnam 1.5-1ubuntu1, no encryption.

De-duplication:

For this test I used a single 33MB pdf file.  The initial repos were
33MB for Obnam and 28MB for Attic.  Then I added a single byte to the
start of the file.  The Obnam repo went to 65MB while the Attic repo
stayed at 28MB.  Both took about 1s for the initial backup and 0.5s
for the second backup.

The remaining testing was done with a Maildir folder containing
23000 files.  The total length of these files is 126MB, and they
occupy 177MB on disk according to du -sh, because of partially
filled blocks.  Here MB means 1024*1024 bytes.

Archive size, as measured by du -sh:

After one backup:

Attic:                65MB
Obnam:               190MB
Obnam with deflate:  127MB

After a second backup with no changes:  the same.

Speed:

From local SSD to itself.  Warm cache.  First number is initial
backup, second is a repeat with no changes.  minutes:seconds

cp -a:           0:01
Attic:           0:08  0:01
Obnam:           0:51  0:05
Obnam deflate:   0:53  0:05

From local SSD to remote HD, over a so-so wifi connection:

rsync:           0:24  0:01
Attic ssh:       0:28  0:05
Attic sshfs:     0:51  0:08
Obnam sftp:      8:45  0:21
Obnam sshfs:    25:22  0:22

Note that when using Attic with sshfs, no software has to be installed
on the remote host.

As another data point, I use unison to do bidirectional
synchronization of my home directory with an offsite server.  5GB,
56000 files.  When there are no changes, it runs in 1 second (!), 
and when there are changes, it is also very efficient.  Can either
of these programs get close to that speed in the future?

Dan</code></pre>
<h2 data-number="4" id="summary">summary</h2>
<p>after obnam failed in any aspect because of performance issues, attic
seems to be what obname promised. i might soon bring attic in as a
replacement for my current modules. one thing i don’t like too much
though is that it requires to run on the target machine and requires a
ssh connection and i a) do not want to run a open ssh server at home nor
b) keep an active reverse tunnel open:</p>
<h2 data-number="5" id="links">links</h2>
<ul>
<li>[1] <a href="https://attic-backup.org/"
class="uri">https://attic-backup.org/</a></li>
<li>[2] <a
href="http://librelist.com/browser/attic/2014/1/31/attic-vs-obnam/"
class="uri">http://librelist.com/browser/attic/2014/1/31/attic-vs-obnam/</a></li>
</ul>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/attic-backup.mdwn" title="posts\attic-backup.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
