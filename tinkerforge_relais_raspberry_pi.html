<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="tinkerforge_relais_raspberry_pi.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>tinkerforge relais raspberry pi</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/tinkerforge_relais_raspberry_pi.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="mailinglist_to_newsgroup_wrapper.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="advanced_webservices_on_nixos_revisited.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  
      <div id="seriesContainer">
      <a href="timeline.html?filter=series::illuminator" title="article series illuminator" class="seriesbtn btn btn-primary">illuminator</a>
        <header class="seriesHeader">
          <div id="seriesLeft">  </div>
          <div id="seriesRight">   <a href="tinkerforge_relais_raspberry_pi_2.html">
              <span class="glyphiconLinkSeries glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article in series"></span>
            </a></div>
        </header>
      </div>

  <div class="article">
    <h1 id="SiteTitle">tinkerforge relais raspberry pi</h1>
    <div id="date"><p><span id="lastupdated">23 feb 2014</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::raspberrypi" class="tagbtn btn btn-primary">raspberrypi</a><a href="timeline.html?filter=tag::tinkerforge" class="tagbtn btn btn-primary">tinkerforge</a><a href="timeline.html?filter=tag::linux" class="tagbtn btn btn-primary">linux</a><a href="timeline.html?filter=tag::usability" class="tagbtn btn btn-primary">usability</a><a href="timeline.html?filter=tag::node.js" class="tagbtn btn btn-primary">node.js</a><a href="timeline.html?filter=tag::scala" class="tagbtn btn btn-primary">scala</a><a href="timeline.html?filter=tag::lift" class="tagbtn btn btn-primary">lift</a></p></div>
    <p><a href="media/tinkerforge-logo.jpg"><img src=media/tinkerforge-logo.jpg style="float: right"></a></p>
<h2 data-number="1" id="motivation">motivation</h2>
<p><strong>i love ambient illumination so i installed about 10 different
LED systems into my room. the downside is that controlling that many
devices manually, which also includes two TFT monitors and my
stereo.</strong> this post documents the various software designs i
tried until i ended up with a node.js installation on a raspberry pi (PI
for short) which is no used several times a day to control my devices’
power states.</p>
<div class="alert alert-danger" role="alert">
<p>WARNING - DISCLAIMER:</p>
<p>i’m no expert in electrical engineering - so if you copy this work,
ask an expert to check on your setup before making daily use. especially
check these things: ***</p>
<ul>
<li><strong>i’m no tinkerforge expert</strong>, check your facts!</li>
<li><strong>do not work with 230V unless you really know what you are
doing, it can kill</strong></li>
<li><strong>ensure that the electrical load you are working with does
not exceed given relais parameters</strong></li>
<li><strong>add a filter so that a single relais isn’t toggled more than
10/min</strong> and disable the control on bursts</li>
<li>consider adding a <a
href="https://en.wikipedia.org/wiki/Residual-current_device"
class="uri">https://en.wikipedia.org/wiki/Residual-current_device</a></li>
<li>this device is running in my LAN, do <strong>not expose it to the
internet without further security additions</strong></li>
<li>consider running the node application <strong>as a normal user and
not as root</strong> as i do</li>
</ul>
<p>in fact, i’ve chosen tinkerforge dual relais bricklets over a
self-built relais to avoid making critical errors which could result in
your house burned to the ground or lives put to danger.</p>
<p>I’M NOT RESPONSIBLE IF YOUR DEVICE KILLS YOUR CAT OR BURNS DOWN YOUR
HOUSE - YOU HAVE TO KNOW WHAT YOU ARE DOING!</p>
</div>
<p>prior to this self-made solution i was considering remote controlled
electrical switches.</p>
<p>the problems i had with these were a mixture of:</p>
<ul>
<li><p><strong>reliability problems</strong></p>
<p>i need to know if a trigger command really worked, if not i could
have used the remote switch bricklet [14]</p></li>
<li><p><strong>short lifespan</strong></p>
<p><strong>remote controlled electrical switches start to break after
1-2 years</strong>; a sign is that you have to trigger the ON-key
several times or that you can’t force them OFF anymore…</p></li>
<li><p><strong>too expensive</strong></p>
<p>openHAB <a href="http://www.openhab.org/features-tech.html"
class="uri">http://www.openhab.org/features-tech.html</a> seems to be
interesting but i think it is quite complex i wouldn’t know if that
stuff works the way i want it to</p></li>
<li><p><strong>horrible usability</strong></p>
<ul>
<li><p><strong>no app support, if so these apps often rely on
proprietary infrastructure</strong></p></li>
<li><p><strong>example</strong>: <a
href="http://www.eq-3.de/produkt-detail-zentralen-und-gateways/items/homematic-zentrale-ccu-2.html"
class="uri">http://www.eq-3.de/produkt-detail-zentralen-und-gateways/items/homematic-zentrale-ccu-2.html</a></p>
<ul>
<li>have a look at the manual, the webpage of the device looks like made
in the 80s and they don’t even the word ‘open source’ so assumably the
interface can’t be modified and is proprietary</li>
</ul></li>
<li><p>probably most vendors do <strong>not provide a REST
interface</strong></p></li>
</ul></li>
<li><p><strong>security issues because of</strong>:</p>
<ul>
<li><strong>proprietary software</strong> or, even worse,</li>
<li>a <strong>proprietary box you place into your NAT</strong> which
constantly connects to a third party vendor to give you app support</li>
<li><strong>wireless with no encryption</strong> or proprietary
encryption</li>
</ul></li>
</ul>
<p>because of this built my own device for controlling 6x 230V using my
PC, phone, tablet or a 3x4 key pad. as a nice side-effect this also gave
me the opportunity to <strong>play with different programming
languages/web development tools</strong>.</p>
<p>here is my setup:</p>
<p><a href="media/tinkerforge_relais_raspberry_pi.jpg"><img src=media/tinkerforge_relais_raspberry_pi.jpg style="float: none" size=700x caption="shows the layout of my setup"></a></p>
<p>the setup consists of:</p>
<ul>
<li><p>raspberry pi (model b)</p></li>
<li><p>tinkerforge</p>
<ul>
<li>master brick - <a
href="http://www.tinkerforge.com/de/doc/Hardware/Bricks/Master_Brick.html#master-brick"
class="uri">http://www.tinkerforge.com/de/doc/Hardware/Bricks/Master_Brick.html#master-brick</a></li>
<li>3x dual relais bricklet - <a
href="http://www.tinkerforge.com/de/doc/Hardware/Bricklets/Dual_Relay.html#dual-relay-bricklet"
class="uri">http://www.tinkerforge.com/de/doc/Hardware/Bricklets/Dual_Relay.html#dual-relay-bricklet</a></li>
<li>1x multi touch bricklet - <a
href="http://www.tinkerforge.com/de/doc/Hardware/Bricklets/Multi_Touch.html#multi-touch-bricklet"
class="uri">http://www.tinkerforge.com/de/doc/Hardware/Bricklets/Multi_Touch.html#multi-touch-bricklet</a></li>
<li>1x 3x4 key pad - <a
href="https://www.tinkerforge.com/en/shop/accessories/sensors/key-pad-3x4.html"
class="uri">https://www.tinkerforge.com/en/shop/accessories/sensors/key-pad-3x4.html</a></li>
</ul></li>
</ul>
<h2 data-number="2" id="hardware-setup">hardware setup</h2>
<p>the following 3 images show my prototype which, at that time, did not
include the multi touch bricklet but instead a 4th dual relais.</p>
<p><a href="media/tinkerforge_relais_raspberry_pi_hardware1.jpg"><img src=media/tinkerforge_relais_raspberry_pi_hardware1.jpg style="float: none" size=700x caption="image shows raspberry pi, network and usb cabeling"></a></p>
<p><a href="media/tinkerforge_relais_raspberry_pi_hardware2.jpg"><img src=media/tinkerforge_relais_raspberry_pi_hardware2.jpg style="float: none" size=700x caption="image shows power sockets"></a></p>
<p><a href="media/tinkerforge_relais_raspberry_pi_hardware3.jpg"><img src=media/tinkerforge_relais_raspberry_pi_hardware3.jpg style="float: none" size=700x caption="image shows the DIN rail with the 230V wiring and how i implemented the cable relief"></a></p>
<h3 data-number="2.1"
id="the-evolution-of-my-tinkerforge-hardware-stack">the evolution of my
tinkerforge hardware stack</h3>
<p>my first setup using tinkerforge [1] hardware and controlled it from
my laptop using USB:</p>
<pre><code>|- masterbrick
|A- dual relias bricklet (2 230V relais)
|B- dual relias bricklet (2 230V relais)
|C- dual relias bricklet (2 230V relais)</code></pre>
<p>the first impression of tinkerforge’s hardware and software were
promising. i integrated the tinkerforge components into a breaker box
but i didn’t add any fuses. tinkerforge relies on a computer taking
control of the stack every time you want the state to change and if you
unplug the usb cable all relais are set to their initial position, which
is OFF.</p>
<h3 data-number="2.2" id="adding-wifi">adding WIFI</h3>
<p>since i wanted to control the stack from my mobile phone and tablet
(as well as from my laptop) i bought the, back then, brand new WIFI
extension [2]. i would have bought the ethernet extension [3] if it had
existed back then. the configuration was pretty easy, but that
connection wasn’t too great because of the bad WIFI signal and maybe
some problems between the wifi extension and the d-link router. anyway i
was able to control the stack most of the time without having to reset
my tinkerforge stack by power cycling the stack.</p>
<pre><code>|- masterbrick
|   |- WIFI Extension
|A- dual relias bricklet (2 230V relais)
|B- dual relias bricklet (2 230V relais)
|C- dual relias bricklet (2 230V relais)</code></pre>
<p><a href="media/extension_wifi_stack_600.jpg"><img src=media/extension_wifi_stack_600.jpg style="float: none" size=300x caption="WIFI extension picture (c) tinkerforge.com"></a></p>
<p>i was using the WIFI extension for weeks but it turned out that my
reception wasn’t very good and had a lot connection issues (probably
caused by bad SNR with additional D-Link quirks).</p>
<h3 data-number="2.3"
id="adding-a-raspberry-pi-and-a-multi-touch-bricklet">adding a raspberry
pi and a multi touch bricklet</h3>
<p>so i came up with a new solution: i added a raspberry pi to the
stack:</p>
<pre><code>|- raspberry pi 
 |- masterbrick 
  |A- dual relias bricklet (2 230V relais)
  |B- dual relias bricklet (2 230V relais)
  |C- dual relias bricklet (2 230V relais)
  |D- multi touch bricklet
   |- 3x4 key pad</code></pre>
<div class="alert alert-info" role="alert">
<p>at tinkerforge they are currently designing the ‘<strong>red
brick</strong>’ <a
href="http://www.tinkerforge.com/en/blog/2014/2/21/tinkerforge-goes-stand-alone-aka-red-brick"
class="uri">http://www.tinkerforge.com/en/blog/2014/2/21/tinkerforge-goes-stand-alone-aka-red-brick</a>.
i’m really looking forward to having one!</p>
</div>
<h3 data-number="2.4" id="power-usage">power usage</h3>
<ul>
<li>1,8W = (230V to usb converter) + raspberry pi + tinkerforge master
brick</li>
<li>additionally: 0,4W per triggered relais, that is: 6 x 0,4 = 2,4W
additional load (peak)</li>
</ul>
<div class="alert alert-info" role="alert">
<p>tinkerforge ‘master brick’ and ‘WLAN extension’ weren’t measureable
so the 1,8W are caused soly by the raspberry pi ;-)</p>
</div>
<h2 data-number="3" id="software">software</h2>
<p>requirements:</p>
<ul>
<li><p>usability optimized for touch screens (big buttons/adaptive
layout)</p></li>
<li><p>interface which can be controlled via curl (or similar) -
REST</p>
<ul>
<li>global shortcuts, see</li>
</ul></li>
<li><p>every attached browser instance must reflect the state (without
having to do manual page reloads), see [6]/[7]</p></li>
<li><p>must be running <em>reasonable</em> fast:</p>
<ul>
<li>time from off to ready must be <em>reasonable</em> fast</li>
<li>fast response times (app must feel interactive)</li>
</ul></li>
</ul>
<p><a href="media/tinkerforge_relais_raspberry_pi_screenshot.jpg"><img src=media/tinkerforge_relais_raspberry_pi_screenshot.jpg style="float: none" caption="shows the layout of my UI controlling the relais"></a></p>
<p>i experimented with different languages:</p>
<ul>
<li><strong>native android app</strong>, running on my nexus7
tablet</li>
<li>ruby with <strong>ruby on rails</strong> (running on the raspberry
pi)<br>
<ul>
<li>i deplyed a hello world example with model/view/controller to my PI
and started it in debug mode - it was simply too slow so i skipped
ruby</li>
</ul></li>
<li>scala using the <strong>lift</strong> framework</li>
<li>javascript with the very fast <strong>node.js</strong>
framework</li>
</ul>
<h3 data-number="3.1" id="native-android-app">native android app</h3>
<p>my initial design was to use the master brick with the WIFI master
extension. i designed a native android application (java) using the
android SDK [8]. it took me one day to write a basic client application
for the nexus 7 and i would like to point out that the android SDK has a
remarkable documentation and workflow.</p>
<p>native android application drawbacks:</p>
<ul>
<li>i had to put all the intelligence into the client application</li>
<li>the socket to control the brick stack was without security
protection, everyone in my LAN with brickv running could control the
stack ;P and there would never be a way around that, except creating a
second wireless LAN.</li>
<li>if i was using my samsung galaxy s2 and nexus 7 in parallel it would
not reflect the real state of the hardware as brickd does not implement
MVC. i would have had to implement polling but i did not like that
idea</li>
<li>back then my WIFI was unstable so i often had to wait a long time
for the initial connect or reset the tinkerforge stack manually</li>
</ul>
<p>client/server implementation (HTTP) advantages:</p>
<ul>
<li>client perspective: everyone with a smart phone/tablet/laptop can
now control the device</li>
<li>server perspective: using the raspberry pi (a linux computer) grants
additional flexibility</li>
</ul>
<h3 data-number="3.2" id="os-deployment-on-the-raspberry-pi">OS
deployment on the raspberry pi</h3>
<p>some remarks about the installation:</p>
<ul>
<li>i’m using <strong>2013-02-09-wheezy-raspbian.zip</strong> [3]</li>
</ul>
<p>after the first boot, i had a keyboard/screen attached and configured
these values:</p>
<ul>
<li>enabled sshd</li>
<li>disabled X</li>
<li>changed the password of the ‘pi’ user</li>
</ul>
<h3 data-number="3.3" id="using-scalalift-and-jetty">using scala/lift
and jetty</h3>
<p>i had been playing with <strong>ruby on rails</strong> so far but,
after i’ve been talking to stefan schlott [3] about my project, i
changed my mind and continued using [4] <strong>scala/lift</strong>.</p>
<blockquote>
<p>Lift code is as clean and brief as Rails, yet performs at least 6
times faster and is multithreaded. Additionally, because Scala is
strongly typed, the compiler catches type errors.</p>
</blockquote>
<p>lift implements ajax and comet [9]/[10] and [11] to make the DOM-tree
dynamically changable (without having to implement page reloads) - i
love this!</p>
<p>i was using IntelliJ [12] for doing most scala/lift development, this
is really a great IDE!</p>
<p>in regards to deployment i found it encouraging that there are
several ppl using jetty on the raspberry pi already and that there is a
collection of <strong>high quality examples about what can be done with
lift</strong>, see [5] and [6].</p>
<p>additional software:</p>
<pre><code>apt-get install vim htop screen jetty8 openjdk-7-jdk</code></pre>
<p>after that i create a war package:</p>
<pre><code>./sbt
package-war</code></pre>
<p>various jetty optimizations:</p>
<pre><code>JAVA_OPTIONS=&quot;-Xmx256m -Drun.mode=production -noverify&quot; # 3 seconds
#JAVA_OPTIONS=&quot;-Xmx256m -Djava.awt.headless=true -noverify -Drun.mode=production&quot; # 3 seconds


# Home of Java installation.
JAVA_HOME=&quot;/usr/lib/jvm/java-7-openjdk-armhf/&quot;</code></pre>
<p>after i applied the optimization i tested the chat app again:</p>
<h4 data-number="3.3.1"
id="lift-performance-on-raspberry-pi-without-optimization-using-firebug">lift
performance on raspberry pi without optimization using firebug</h4>
<p><a href="media/chat-app-lift1.jpeg"><img src=media/chat-app-lift1.jpeg style="float: none" size=700x></a></p>
<p>the comet roundtrip time was from hitting return on the client and
seeing the view updates on the client is about <strong>2250
ms</strong>.</p>
<h4 data-number="3.3.2"
id="lift-performance-on-raspberry-pi-after-optimization-using-firebug">lift
performance on raspberry pi after optimization using firebug</h4>
<p><a href="media/chat-app-lift2.jpeg"><img src=media/chat-app-lift2.jpeg style="float: none" size=700x></a></p>
<p>the comet roundtrip time was from hitting return on the client and
seeing the view updates on the client is about <strong>273
ms</strong>.</p>
<p>in both cases this means 100% PI CPU usage for the shown time.</p>
<h4 data-number="3.3.3" id="scalalift-summary">scala/lift summary:</h4>
<ul>
<li><p><strong>restarting jetty took about 1-3 minutes</strong> after
heavy optimizations, which i can’t remember right now. <strong>clicking
button using comet took about 1 second of 100% cpu load on the PI until
the other clients were updated.</strong> however, i was using openjdk
which is AFAIK not optimized for ARM and also lacks JIT (runtime
optimization). about 2-4 months after i started using scala oracle
released embedded java (or similar) but i didn’t try it</p></li>
<li><p><strong>i don’t like the fact that i need to edit/build the
application on a different system than the PI since the java IDEs like
IntelliJ or eclipse are very demanding</strong></p></li>
<li><p>i didn’t find out how to make the comet (or java) faster and
wonder why [13] seems to be so fast</p></li>
<li><p>scala with lift seems to be a very cool framework and probably
got potential</p></li>
<li><p>lift comets are implemented using ‘<strong>long polling</strong>’
[13] and are not based on websockets yet:</p>
<p>the manual says:</p>
<blockquote>
<p>Lift’s current Comet implementation uses long polling. In the future,
Lift will also use WebSockets, but the WebSocket API and implementation
isn’t “baked” yet, and Lift’s current implementation works well for
browsers from IE6 on. Lift’s long polling implementation opens a single
HTTP connection from the browser to the server if one or more Comet
components are detected on a HTML page. The request contains a list of
the components and the “version” for each of the components. If the
version number of any of the components on the server is “newer” than
the version on the client, the deltas are sent as the response, the
connect is closed, the browser applies the deltas and then re-opens the
HTTP connection (with HTTP 1.1 keep-alive this does not imply reopening
a TCP/IP connection.) If the version of the component changes while the
HTTP “poll” is open, the deltas are sent down as a response and the
connection is closed. If no state changes after 110 seconds (this is a
tunable parameter), a noop is sent to the browser and the browser
re-opens the HTTP connection. The 110 second timeout is to insure that
Lift’s comet implementation is proxy friendly.</p>
</blockquote>
<p>i like socket.io for node.js which implements websockets where
possible and uses long polling as fallback already.</p></li>
</ul>
<h3 data-number="3.4" id="using-javascriptnode.js">using
javascript/node.js</h3>
<p>compiling node on the PI took about 30-70 minutes IIRC. the first
‘hello world’ applications were easy to understand and were very
fast.</p>
<p>the source for this project can be found here:</p>
<p><a href="https://github.com/qknight/relais.js/blob/master/relais.js/"
class="uri">https://github.com/qknight/relais.js/blob/master/relais.js/</a></p>
<h4 data-number="3.4.1" id="mvc-missunderstandings">MVC
missunderstandings</h4>
<p>my first problem was that i didn’t understand MVC in node.js. i was
trying ember.js to get realtime sync in the views without realizing that
most of these frameworks are, despite what MVC might imply, not doing
that. most of them require a F5 refresh to sync the views but i wanted
sync in realtime. since i was new to node programming i didn’t
understand how to keep track of all websocket contexts at first but
after reading the excellent code from Olli K [5] it dawned on me.</p>
<p>at the time of this writing i was still using websockets directly,
like done in example [5], instead of using socket.io. but i’d like to
adapt to socket.io.</p>
<p>see: <a href="http://vuejs.org/perf/"
class="uri">http://vuejs.org/perf/</a> Performance Comparisons</p>
<h4 data-number="3.4.2"
id="external-programs-to-talk-to-the-tinkerforge-stack">external
programs to talk to the tinkerforge stack</h4>
<p><s>since there are no node.js bindings for the tinkerforge
library</s> (<strong>update 24.2.2014 14:14</strong>: see <a
href="http://www.tinkerunity.org/forum/index.php/topic,2216.0.html"
class="uri">http://www.tinkerunity.org/forum/index.php/topic,2216.0.html</a>).
anyway, i’m still using using c-programs to access the tinkerforge
stack:</p>
<ul>
<li><p>relais-tool - <a
href="https://github.com/qknight/relais.js/tree/master/relais-tool"
class="uri">https://github.com/qknight/relais.js/tree/master/relais-tool</a></p>
<p>is queried and returns a JSON formaitted answer which is
processed</p></li>
<li><p>keypad-tool - <a
href="https://github.com/qknight/relais.js/tree/master/keypad-tool"
class="uri">https://github.com/qknight/relais.js/tree/master/keypad-tool</a></p>
<p>reports 3x4 key pad changes via JSON formatted to server.js</p></li>
</ul>
<p>the integration is actually pretty simple and it is using stdin
parsing with JSON messaging!</p>
<h4 data-number="3.4.3"
id="using-the-restful-interface-from-the-shell">using the RESTful
interface from the shell</h4>
<p>since i want to use curl based scripts to access the relais, here is
a bash shell script for triggering relais:</p>
<pre><code>cat .trigger_relais
#!/bin/sh
relais=$1
cred=&quot;admin:admin&quot;
ip=&quot;192.168.0.48&quot;

state=$(curl --user &quot;$cred&quot; http://${ip}/state/${1})
nstate=&quot;0&quot;

if [ &quot;$state&quot; == &quot;0&quot; ]; then
  nstate=1
else
  nstate=0
fi

echo $nstate

curl --user &quot;$cred&quot; -i -X PUT -H &#39;Content-Type: application/json&#39; -d &#39;{&quot;value&quot;: &quot;&#39;$nstate&#39;&quot;}&#39; http://${ip}/state/$1</code></pre>
<p>with this command line:</p>
<pre><code>./.trigger_relais 1</code></pre>
<h4 data-number="3.4.4" id="starting-relais.js-on-boot">starting
relais.js on boot:</h4>
<p>to start the node application after each boot i do:</p>
<p>edit your crontab using ‘<strong>crontab -e</strong>’:</p>
<pre><code>@reboot /root/relais.js/starter.sh</code></pre>
<p><strong>note</strong>: if the process crashes (or it receives a
exception) it won’t be restarted automatically. if that gets a problem
i’ll add a while true; do …; done loop into starter.sh</p>
<h2 data-number="4" id="summary">summary:</h2>
<ul>
<li>i love the async nature of node.js</li>
<li>using websockets directly is really easy. however, then you’ll need
webkit on all android devices since the preinstalled webbrowser does not
know about websockets</li>
<li>talking to external programs using spawn in node.js is very easy and
using JSON for comunication is very easy</li>
</ul>
<h2 data-number="5" id="conclusion">conclusion</h2>
<p><strong>usability: using my device is so cool as all interfaces are
very responsive and work reliably</strong>, better than anything i had
been using before.</p>
<p><strong>tinkerforge development is impressive</strong>. back when i
started using it there was no WIFI extension, no multi touch bricklet
and when writing this article i saw the exciting ‘red brick’ blog
announcement - which could get a nice raspberry pi replacment if it runs
using linux of course! <strong>i’m now using this hardware every day,
for at least on year now, and so far it is rock solid</strong>.</p>
<p><strong>node.js is a powerful framework and is very fast on the
PI.</strong> i can’t stress this fact enough - really, try it!</p>
<p>things which would be cool to have:</p>
<ul>
<li>a bluetooth bricklet based on <a
href="http://www.golem.de/news/tdk-winziges-bluetooth-modul-fuer-low-energy-geraete-1402-104545.html"
class="uri">http://www.golem.de/news/tdk-winziges-bluetooth-modul-fuer-low-energy-geraete-1402-104545.html</a>
with strong encryption on top of the protocol</li>
<li>relais.js needs cookie support and it should use HTTPS instead
instead of HTTP</li>
<li>for better deployment i should consider using NixOS on the PI by
porting all this stuff to it, see: <a
href="https://nixos.org/wiki/Raspberry_Pi"
class="uri">https://nixos.org/wiki/Raspberry_Pi</a></li>
<li>voice input (with open source and without having to use SaaS) see:
<a href="http://jasperproject.github.io/documentation/usage/"
class="uri">http://jasperproject.github.io/documentation/usage/</a></li>
</ul>
<p>if you want to <strong>give me feedback</strong>, please mail to:
js@lastlog.de</p>
<p>see also: <a href="https://news.ycombinator.com/item?id=7384549"
class="uri">https://news.ycombinator.com/item?id=7384549</a></p>
<h2 data-number="6" id="copyright-notice">copyright notice</h2>
<p>images were taken (and remixed by me) from:</p>
<ul>
<li>wikipedia - <a href="https://www.wikipedia.org/"
class="uri">https://www.wikipedia.org/</a></li>
<li>tinkerforge.com - <a href="http://tinkerforge.com"
class="uri">http://tinkerforge.com</a></li>
<li>oxygen icons - <a href="http://www.oxygen-icons.org/"
class="uri">http://www.oxygen-icons.org/</a></li>
<li>raspberry pi - <a href="http://www.raspberrypi.org/faqs"
class="uri">http://www.raspberrypi.org/faqs</a></li>
</ul>
<h2 data-number="7" id="links">links</h2>
<ul>
<li>[1] <a href="http://www.tinkerforge.com/"
class="uri">http://www.tinkerforge.com/</a></li>
<li>[2] <a
href="http://www.tinkerforge.com/de/doc/Hardware/Master_Extensions/WIFI_Extension.html"
class="uri">http://www.tinkerforge.com/de/doc/Hardware/Master_Extensions/WIFI_Extension.html</a></li>
<li>[3] <a
href="http://www.tinkerforge.com/de/doc/Hardware/Master_Extensions/Ethernet_Extension.html"
class="uri">http://www.tinkerforge.com/de/doc/Hardware/Master_Extensions/Ethernet_Extension.html</a></li>
<li>[4] <a href="http://developer.android.com/sdk/index.html"
class="uri">http://developer.android.com/sdk/index.html</a></li>
<li>[5] <a href="https://github.com/gildean/raspi-ledblinker"
class="uri">https://github.com/gildean/raspi-ledblinker</a></li>
<li>[6] <a href="http://www.raspberrypi.org/downloads"
class="uri">http://www.raspberrypi.org/downloads</a></li>
<li>[7] <a href="http://demo.liftweb.net/chat"
class="uri">http://demo.liftweb.net/chat</a></li>
<li>[8] <a href="https://github.com/lift/examples"
class="uri">https://github.com/lift/examples</a></li>
<li>[9] <a href="http://en.wikipedia.org/wiki/Comet_(programming)"
class="uri">http://en.wikipedia.org/wiki/Comet_(programming)</a></li>
<li>[10] <a
href="http://lifeofaprogrammergeek.blogspot.de/2010/06/deploying-war-in-jetty.html"
class="uri">http://lifeofaprogrammergeek.blogspot.de/2010/06/deploying-war-in-jetty.html</a></li>
<li>[11] <a
href="https://fmpwizard.telegr.am/blog/lift-running-on-raspberrypi"
class="uri">https://fmpwizard.telegr.am/blog/lift-running-on-raspberrypi</a></li>
<li>[12] <a
href="https://www.assembla.com/spaces/liftweb/wiki/Using_IntelliJ_IDEA_to_develop_Lift_applications"
class="uri">https://www.assembla.com/spaces/liftweb/wiki/Using_IntelliJ_IDEA_to_develop_Lift_applications</a></li>
<li>[13] <a href="http://lift.la/lift-and-data-driven-comet"
class="uri">http://lift.la/lift-and-data-driven-comet</a></li>
<li>[14] <a
href="http://www.tinkerforge.com/de/doc/Hardware/Bricklets/Remote_Switch.html#remote-switch-bricklet"
class="uri">http://www.tinkerforge.com/de/doc/Hardware/Bricklets/Remote_Switch.html#remote-switch-bricklet</a></li>
</ul>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/tinkerforge_relais_raspberry_pi.mdwn" title="posts\tinkerforge_relais_raspberry_pi.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
