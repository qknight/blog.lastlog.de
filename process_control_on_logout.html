<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="process_control_on_logout.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>process control on logout</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/process_control_on_logout.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="virtualization.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="networkmanager.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  

  <div class="article">
    <h1 id="SiteTitle">process control on logout</h1>
    <div id="date"><p><span id="lastupdated">20 oct 2009</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::linux" class="tagbtn btn btn-primary">linux</a><a href="timeline.html?filter=tag::technology" class="tagbtn btn btn-primary">technology</a><a href="timeline.html?filter=tag::usability" class="tagbtn btn btn-primary">usability</a></p></div>
    <p>[[!summary chatGPT: A user is experiencing issues with a poor driver
for their ATI Radeon R300 card on Linux, leading to frequent X crashes
and the need to restart X when hot plugging external displays; they also
mention the problem of ssh not being able to resume disconnected
sessions, and propose using “screen” to solve this issue and suggest
implementing it in the “konsole” terminal emulator.</p>
<p>Since I am using a <strong>ATI Radeon “R300”</strong> card, that is a
card with a very poor written driver (at least for linux) I’m facing
frequent X-Crashes or I am forced to restart X on ‘<strong>hot
plugging</strong>’ of external displays.Yes ‘hot plugging’ does
sometimes work, sometimes not.</p>
<p>Since I’m also admin of several servers I’m also faced to the fact
that ssh can not resume a disconnected session - that is since the
session (OSI-model, layer 5, see [1]) isn’t implemented the layer 4
connection is associated as session instead. That is a common among many
programs used today - either surfing the internet or the local
network<strong>.</strong> <strong>However</strong> <strong>the
consequence is that once the connection is down it is unlikely to be
resumed</strong> even though socket is still open on both server and
client while the ip has not changed - a simple tcp timeout on one end
can reset the connection.</p>
<p>If such a session is broken the result is that all started processes
(which can be many, since they can be run in the background with the
&amp; operator) are closed immediately. For some operations as “mv dir1
dir2/” this can be fatal. Since this will <strong>result in
inconsistencies</strong> most of the times.</p>
<p>The mainstream solution to this problem is using a program called
“screen”. <strong>This “screen” has many features which make it a
program worth knowing</strong> - even for local use, see [2] for screen
commands I’m frequently using.</p>
<p><a href="media/screen_in_konsole.png"><img src=media/screen_in_konsole.png alt="today i had the already mentioned problem: **xbuffer screwup**" style="float: none"></a></p>
<p>So back to the topic of this posting the issue with the bad R300
driver and X session resets.</p>
<p>The issue here is:</p>
<ul>
<li>once the X server goes down my music I’m currently listening is also
going down</li>
<li>all my ‘konsole’ consoles are killed (which can be plenty)</li>
<li>all my programs which use X (no wonder) are also gone</li>
</ul>
<p><strong>I would like to have ‘konsle’ to use a screen on every new
‘konsole tab’ I create</strong>. Or since screen itself can nest several
consoles in one screen instance (that is one process) - why not start a
single screen and attach the ‘konsole’ session to this screen. When a
second tab is opened the second tab is automatically adding a new screen
tab as well.</p>
<p>Once X goes down all processes are exited as already known - except
screen. ‘Screen’ <strong>does not react</strong> to <strong>SIGTERM
</strong>- it just keeps running. Later when you started into a new ‘X
session’ you can open any console as for example ‘xterm’ or ‘konsole’
and with ‘screen -r’ you can resume your session.</p>
<p>Now imagine ‘konsole’ to do this wrapping automatically. I could live
with a toggle to switch the associated console back and forth between
‘<strong>session</strong>’ behavior and ‘<strong>pervasive</strong>’
behavior.</p>
<p><strong>UPDATE: </strong>Think of this ‘screen in konsole’ as you are
already used to with firefox’s multiple tabs when doing store/restore
after logout/login. (not reboot of course since our screen instances are
useless after reboot).</p>
<p>This would be an incredible feature for ‘konsole’.</p>
<p>#links</p>
<ul>
<li>[1] <a href="http://en.wikipedia.org/wiki/OSI_model"
class="uri">http://en.wikipedia.org/wiki/OSI_model</a></li>
<li>[2] <a href="http://lastlog.de/wiki/index.php/Screenbefehle"
class="uri">http://lastlog.de/wiki/index.php/Screenbefehle</a></li>
<li>[3] <a href="http://defindit.com/readme_files/bash_examples.html"
class="uri">http://defindit.com/readme_files/bash_examples.html</a></li>
</ul>
<p>#update <strong>UPDATE: </strong> ‘eliasp’ just told me to edit the
‘konsole’ profile with Settings-&gt;Manage current profile. Setting the
command to “<strong>screen /bin/zsh</strong>” instead of
“<strong>/bin/zsh</strong>” at least creates screen consoles on every
new ‘konsole’ tab opened. I love this workaround but konsole should also
resume. Consider a X crash now, after relaunch of kde I open just new
‘screens’ instead of <strong>attache</strong> them.</p>
<p><strong>UPDATE:</strong> ‘eliasp’ also mentioned [3]. I once tried to
start ‘screen’ on my internet server on login. The problem doing so is
not recognized when using ‘ssh’ but it will** stop ‘scp’ from working**.
Using [3] one can also detect “Disable xon/xoff and interactive login”
when running screen on the remote side. This probably helps to
circumvent the scp issue. Maybe once can also detect a running instance
of ‘screen’ and reattache with ‘screen -dr’ or something alike.</p>
<p>I thank ‘eliasp’ for his feedback.</p>
<hr />
<p><strong>UPDATE:</strong> the proposal was accepted: <a
href="http://forum.kde.org/brainstorm.php#idea83059">http://forum.kde.org/brainstorm.php#idea83059</a></p>
<p><strong>UPDATE:</strong> (2009-11-12) <a
href="https://launchpad.net/byobu">https://launchpad.net/byobu</a> seems
to do things as expected. I have not tested this yet but a friend of
mine reported that.</p>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/process_control_on_logout.mdwn" title="posts\process_control_on_logout.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
