<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="package_management_done_differently_nix.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>package management done differently nix</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/package_management_done_differently_nix.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="evopedia_is_running_on_arch_linux.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="evopedia_on_windows_with_installer.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  

  <div class="article">
    <h1 id="SiteTitle">package management done differently nix</h1>
    <div id="date"><p><span id="lastupdated">24 dec 2010</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::tech" class="tagbtn btn btn-primary">tech</a></p></div>
    <p><a href="media/nixos-lores.png"><img src=media/nixos-lores.png alt="" style="float: right"></a></p>
<h2 data-number="1" id="motivation">motivation</h2>
<p>package management is great when it just works. but often ‘edge
cases’ reveal shortcomings in the respective package manager. a very
innovative approach to package deployment is implemented in the NIX
package manager.</p>
<p>if you are only interested in the technical side of my recent
findings about NIX, skip chapter::‘my linux journey’ and read on at
chapter::‘NIX OS’, below.</p>
<h2 data-number="2" id="my-linux-journey-so-far.">my linux journey, so
far….</h2>
<p>originally i started my** linux journey** with
<strong>redhat</strong>, impressed by the <strong>debian</strong>
package manager <strong>apt</strong>, i soon changed over to
<strong>debian linux</strong>.</p>
<p>i’ve used debian when kde 3 was finally released and altough i was
quite happy with kde 2 soon i realized that kde 2 had to give way for
the kde 3 integration. if i recall correctly it was quite hard to use
kde 2 in parallel. at that time kde 3 (the first days/weeks after the
release in debian) was unusable and crashed all over the place. that
keept this way until the relese of kde ‘3.5’.</p>
<p>so the main problem with kde 3 was that it contained arts (an audio
daemon like ESD) which was tightly coupled to ‘kde 3.x’. a normal
desktop user would never had issues with that but as i always was
interested in jackd, the ‘audio connection kit’ for low latency audio
stuff. the main problem was that the dependencies for arts somehow made
it very complicated when wanting also jackd installed on the same
system. as there were no useflags, as in gentoo linux, i didn’t have
much joy, as i had to decide between kde or jackd.</p>
<p>in the end i experimented with <strong>gentoo linux</strong> and
that’s what i’m stuck with until today. but back then one could install
kde 3 and jackd at the same time without much burden. but soon after i
moved from debian to gentoo there was a kde 4 release. this resulted in
horrible kde3 vs kde4 problems. finally i had to remove my beloved, back
then stable 3.5 kde installation and was forced to use the kde 4 alpha
release quality software.</p>
<p>in gentoo there had been support for a ‘<strong>prefix</strong>’
<strong>installation</strong> of ‘<strong>kde 3.x and 4.x</strong>’
which also made several parallel kde 4 installations possible. of course
one could also install kde3 and kde4 at the same time. but support for
the ‘kde prefix’ installation is probably gone by now and with it the
kde3 support.</p>
<p>so NIX OS does solve two problems at the same time:</p>
<ul>
<li>to some degree it has use flags, as gentoo does</li>
<li>all installed software is installed as done in gentoo when doing a
kde prefix installation</li>
</ul>
<p>anyway, enough kde history, let’s see what nix actually is…</p>
<h2 data-number="3" id="nix-os">NIX OS</h2>
<p>i’ve been experimenting with <strong>NIX OS</strong> lately. NIX is a
package manager, or in nix terms a ‘component deployment tool’. Nix has
some very unique and innovative features i’ve not yet seen yet.</p>
<p>here is a incomplete list of features i like:</p>
<ul>
<li>one can install <strong>several different version of a single
program at the same time</strong></li>
<li>still only one ‘selected’ version is executed, when typing “firefox”
for instance</li>
<li><strong>installation of components is atomic</strong>, no system
breakage after hitting ‘reset’ too early</li>
<li><strong>if a upgrade to a more recent version fails, one can
roll-back nearly instantly</strong></li>
<li>there is <strong>no difference between source deployment and binary
deployment</strong> anymore</li>
<li><strong>all packages are now ‘read only’</strong>, so one could say
that a package could be copied between systems even after
installation</li>
<li><strong>nix can be used ad-hoc</strong> in linux distributions and
even on windows and mac os x</li>
<li><strong>nix can be used to produce cross platform builds or to
automate processes with dependencies in general</strong></li>
<li>services (or in nix terms compositions) can be cloned from one
computer to another very easily</li>
<li><strong>NIX replaces Make/Autotools/CMake and similar
tools</strong></li>
</ul>
<p>most points listed here, can also be found at [1].</p>
<p>in <strong>other package managers</strong> as (<strong>portage,
apt</strong>, …) there is only a <strong>global namespace</strong> which
is dictated by the distribution. this name dictates package names and
dependencies. i would like to call this a ‘build time’ namespace.
<strong>nix moves this ‘build time’ namespace issue into a runtime
namespace issue</strong> as one can have two different versions of the
same program installed but only one can be marked as active (read: used
in a profile).</p>
<h2 data-number="4" id="how-is-a-nix-component-composed">how is a ‘Nix
component’ composed?</h2>
<p>to learn how Nix works i decided to make the ‘evopedia’ [2] project
available on Nix OS.</p>
<h3 data-number="4.1" id="creating-a-component">1. creating a
component</h3>
<p>looking at the <strong>nix manual</strong> [3] and the very
informative <strong>phd-thesis</strong> [4] from <strong>Eelco
Dolstra</strong> i’ve decided to start in:</p>
<pre><code>cd ﻿/etc/nixos/nixpkgs/pkgs/applications/science/misc/
mkdir evopedia
cd evopedia
vi default.nix</code></pre>
<h3 data-number="4.2" id="default.nix-for-evopedia">2. default.nix (for
evopedia)</h3>
<p>[[!format Lisp ““” {stdenv, fetchurl, bzip2, qt, libX11}:</p>
<p>stdenv.mkDerivation rec { name = “evopedia-0.4.2”;</p>
<p>src = fetchurl { url = “http://evopedia.info/src/${name}.tar.gz”;
sha256 =
“79e372d78e34e252e363a64c55cf6952d4930b226c01110452770faf189ff88b”;
};</p>
<p>configurePhase = ’’ qmake PREFIX=$out ’’;</p>
<p>buildInputs = [ bzip2 qt libX11 ];</p>
<p>meta = { description = “Offline Wikipedia Viewer”; homepage =
http://www.evopedia.info; license = “GPLv3+”; maintainers = with
stdenv.lib.maintainers; [viric]; platforms = with stdenv.lib.platforms;
linux; }; } “““]]</p>
<h3 data-number="4.3"
id="injecting-the-new-component-into-the-system">3. injecting the new
component into the system</h3>
<p>/etc/nixos/nixpkgs/pkgs/top-level/all-packages.nix should contain
this:</p>
<p>[[!format Lisp ““” evopedia = callPackage
../applications/science/misc/evopedia { qt = qt4; }; ““”]]</p>
<p>compared to c, this is like a <strong>#include “foo.h”</strong>
statement, inserting the evopedia expression somewhere.</p>
<h3 data-number="4.4" id="installation">4. installation</h3>
<pre><code>nix-env -i evopedia</code></pre>
<h2 data-number="5" id="summary">summary</h2>
<p>evopedia can be found in nixpkgs already, so you don’t have to do
this in order to use evopedia.</p>
<p>think about this as an example how to deploy your software on Nix
os.</p>
<h2 data-number="6" id="thanks">thanks</h2>
<p>i’m very thankful for the support from developers at
<strong>irc.freenode.net#nixos</strong></p>
<h2 data-number="7" id="links">links</h2>
<ul>
<li>[1] <a href="http://nixos.org/"
class="uri">http://nixos.org/</a></li>
<li>[2] <a href="http://evopedia.info"
class="uri">http://evopedia.info</a></li>
<li>[3] <a href="http://hydra.nixos.org/build/565033/download/1/manual/"
class="uri">http://hydra.nixos.org/build/565033/download/1/manual/</a></li>
<li>[4] <a href="http://nixos.org/docs/papers.html"
class="uri">http://nixos.org/docs/papers.html</a> [^1]: this is the
footnote</li>
</ul>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/package_management_done_differently_nix.mdwn" title="posts\package_management_done_differently_nix.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
