<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="ruckig_motion_planning.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>ruckig motion planning</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/ruckig/ruckig_motion_planning.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="strategic_innovation_in_europe.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="gopass.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  
      <div id="seriesContainer">
      <a href="timeline.html?filter=series::emscripten" title="article series emscripten" class="seriesbtn btn btn-primary">emscripten</a>
        <header class="seriesHeader">
          <div id="seriesLeft"><a href="xmlmirror.html"><span class="glyphiconLinkSeries glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article in series"></span>
            </a>   </div>
          <div id="seriesRight"></div>
        </header>
      </div>

  <div class="article">
    <h1 id="SiteTitle">ruckig motion planning</h1>
    <div id="date"><p><span id="lastupdated">24 may 2023</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::ruckig" class="tagbtn btn btn-primary">ruckig</a><a href="timeline.html?filter=tag::emscripten" class="tagbtn btn btn-primary">emscripten</a><a href="timeline.html?filter=tag::motionplanning" class="tagbtn btn btn-primary">motionplanning</a></p></div>
    <p><a href="media/Emscripten_logo_full.png"><img src=media/Emscripten_logo_full.png width="250px" class="noFancy" style="float: right"></a></p>
<style>

    #box1 {
        display: flex;
        flex-flow: column;
        height: 100%;
    }
    .container1 {
        display: flex;
        justify-content: space-between;
        width: 100%;
    }
    .input-group1 {
        flex-basis: 50%;
        display: flex;
        flex-direction: column;
    }

    .input-group1 label,
    .input-group1 input {
        width: 100%;
    }
    #top {
        flex: 0 1 auto;
    }
    #gd {
        flex: 1 1 auto;
    }
    #error-box {
        background-color: #ff0000de;
        z-index: 99;
        height: 40%;
        width: 100%;
        border-top: black dotted 5px;
        border-bottom: black dotted 5px;
        visibility: hidden;
    }
    #ohsnap {
        font-size: 40px;
    }
    #error-box-text {
        font-size: 23px;
    }
</style>
<h2 data-number="1" id="motivation">motivation</h2>
<p>as i had to maintain a <strong>motion planning library</strong> in
the past, i was freaked to find <a
href="https://github.com/pantor/ruckig">ruckig library</a>. see also <a
href="https://arxiv.org/pdf/2105.04830.pdf"
class="uri">https://arxiv.org/pdf/2105.04830.pdf</a>.</p>
<p>i wanted to use it in the browser, so i compiled using <a
href="https://emscripten.org/">emscripten</a> and used <a
href="https://plotly.com/javascript/">plotly.js</a> for the UI. the
result can be found here: <a
href="https://github.com/qknight/ruckig/tree/15_visualizer"
class="uri">https://github.com/qknight/ruckig/tree/15_visualizer</a></p>
<h3 data-number="1.1" id="motion-planing-in-the-browser">motion planing
in the browser</h3>
<div id="box">
<div id="top">
<div class="container1" style="background-color: #7ce5e5;">
<div class="input-group1">
<p><label for="current_position">current_position:</label>
<input type="number" value="-5" id="current_position" name="current_position"></p>
</div>
<div class="input-group1">
<p><label for="current_velocity">current_velocity:</label>
<input type="number" value="0" id="current_velocity" name="current_velocity"></p>
</div>
<div class="input-group1">
<p><label for="current_acceleration">current_acceleration:</label>
<input type="number" value="0" id="current_acceleration" name="current_acceleration"></p>
</div>
</div>
<div class="container1" style="background-color: #88ec71;">
<div class="input-group1">
<p><label for="target_position">target_position:</label>
<input type="number" value="5" id="target_position" name="target_position"></p>
</div>
<div class="input-group1">
<p><label for="target_velocity">target_velocity:</label>
<input type="number" value="0" id="target_velocity" name="target_velocity"></p>
</div>
<div class="input-group1">
<p><label for="target_acceleration">target_acceleration:</label>
<input type="number" value="0" id="target_acceleration" name="target_acceleration"></p>
</div>
</div>
<div class="container1" style="background-color: #ffdf2f;">
<div class="input-group1">
<p><label for="max_jerk">max_jerk:</label>
<input type="number" value="1" id="max_jerk" name="max_jerk"></p>
</div>
<div class="input-group1">
<p><label for="max_velocity">max_velocity:</label>
<input type="number" value="21" id="max_velocity" name="max_velocity"></p>
</div>
<div class="input-group1">
<p><label for="max_acceleration">max_acceleration:</label>
<input type="number" value="1.148" id="max_acceleration" name="max_acceleration"></p>
</div>
</div>
</div>
<div id="error-box">
<div id="ohsnap">
oh snap…
</div>
<div id="error-box-text">
<p>tbd</p>
</div>
</div>
<div id="gd">

</div>
</div>
<script></script>
<script src="posts/ruckig/plotly-2.23.2.min.js"></script>
<script src="posts/ruckig/15_visualizer.js"></script>
<script>
  function updateGraphCallback(rawjson) {
      console.log("updateGraphCallback has been called", rawjson)
      updateGraph(rawjson)
  }

  function updateGraph(rawjson) {
      var t = [], p = [], v = [], a = [], j = [];
      var isMobileViewPort = false;
      if (window.matchMedia("(min-width: 600px)").matches) {
        isMobileViewPort = true;
      }

      json = JSON.parse(rawjson)
      console.log(json)

      for (var i = 0; i < json["curve"]["data"].length; i++) {
          //time, position, velocity, acceleration, jerk
          row = json["curve"]["data"][i]
          t.push(row[0]);
          p.push(row[1]);
          v.push(row[2]);
          a.push(row[3]);
          j.push(row[4]);
      }
      var data = [
          {x: t, y: p, name: "position [m]"},
          {x: t, y: v, name: "velocity [m/s]"},
          {x: t, y: a, name: "acceleration [m/s^2]"},
          {x: t, y: j, name: "jerk [m/s^3]"},
      ];
      var shapes = [{
          type: 'line',
          yref: 'paper',
          xref: 'x',
          x0: json["trajectory_duration"],
          y0: -10,
          x1: json["trajectory_duration"],
          y1: 10,
          line: {
              color: 'black',
              width: 0.5,
          }
      }]
      var layout = {
          "title": "S-Curve diagram",
              autosize: true,
              dragmode: 'pan',
              margin: {
                  l: 50,
                  r: 10,
                  b: 70,
                  t: 50,
                  pad: 10
              },
          hovermode: "x",
          shapes,
          showlegend: isMobileViewPort
      };
      var config = {
          'modeBarButtonsToRemove': ['zoom'],
          scrollZoom: true,
          displayModeBar: isMobileViewPort,
      }
      Plotly.newPlot("gd", data, layout, config);
  }

computeCurve = Module.cwrap('computeCurve', 'string', ['number', 'number', 'number', 'number', 'number', 'number', 'number', 'number', 'number'])

function getParamter(key) {
    value = document.getElementById(key).value
    return value
}

function GetParamtersAndComputeCurve() {
    var url = new URL(window.location);

    var current_position = getParamter("current_position");
    url.searchParams.set("current_position", current_position)
    var current_velocity = getParamter("current_velocity")
    url.searchParams.set("current_velocity", current_velocity)
    var current_acceleration = getParamter("current_acceleration")
    url.searchParams.set("current_acceleration", current_acceleration)

    var target_position = getParamter("target_position")
    url.searchParams.set("target_position", target_position)
    var target_velocity = getParamter("target_velocity")
    url.searchParams.set("target_velocity", target_velocity)
    var target_acceleration = getParamter("target_acceleration")
    url.searchParams.set("target_acceleration", target_acceleration)

    var max_velocity = getParamter("max_velocity")
    url.searchParams.set("max_velocity", max_velocity)
    var max_jerk = getParamter("max_jerk")
    url.searchParams.set("max_jerk", max_jerk)
    var max_acceleration = getParamter("max_acceleration")
    url.searchParams.set("max_acceleration", max_acceleration)

    window.history.pushState({}, '', url)

    var ret = computeCurve(
        current_position,
        current_velocity,
        current_acceleration,
        target_position,
        target_velocity,
        target_acceleration,
        max_velocity,
        max_jerk,
        max_acceleration
    );
    if (ret !== "") {
        document.getElementById('error-box-text').innerHTML = ret;
        document.getElementById('error-box').style.visibility = "visible";
    } else {
        document.getElementById('error-box').style.visibility = "hidden";
    }
};

function setDefaultValue(key, defaultValue) {
    const urlParams = new URLSearchParams(document.URL);
    value = defaultValue;
    if (urlParams.has(key)) {
        value = urlParams.get(key)
    }
    document.getElementById(key).setAttribute('value', value);
    document.getElementById(key).setAttribute( "onchange", "GetParamtersAndComputeCurve()" );
}

function InitParameters() {
    console.log("InitParameters")
    setDefaultValue("current_position", -5)
    setDefaultValue("current_velocity", 0)
    setDefaultValue("current_acceleration", 0)

    setDefaultValue("target_position", 5)
    setDefaultValue("target_velocity", 0)
    setDefaultValue("target_acceleration", 0)

    setDefaultValue("max_velocity", 21)
    setDefaultValue("max_jerk", 1)
    setDefaultValue("max_acceleration", 1.148)

    GetParamtersAndComputeCurve()
}
     console.log('before Module[onRuntimeInitialized');

Module['onRuntimeInitialized'] = InitParameters;
</script>
<p>note: above should be a plotly.js graph, if not, it might not work in
your browser.</p>
<h2 data-number="2" id="conclusion">conclusion</h2>
<p>i’ve documented the process in the <a
href="https://github.com/qknight/ruckig/commit/45ba491c35707d76e239770a695cf47d563e644e?short_path=afd3506#diff-afd35063cd397b0616c3d498af9af06d61ffef7c30146885432e0c0265ed7813">README.md</a>
and using the docker image from emscripten is is now trivial to kick
off!</p>
<p>this work shines because of the quality of emscripten! compiling
c/c++ code to javascript, even with cmake, is blazingly easy.</p>
<p>oh, and since you are still here, my favourite video in this regard
is <a href="https://www.youtube.com/watch?v=KPoeNZZ6H4s"
class="uri">https://www.youtube.com/watch?v=KPoeNZZ6H4s</a>!</p>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/ruckig/ruckig_motion_planning.mdwn" title="posts\ruckig\ruckig_motion_planning.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
