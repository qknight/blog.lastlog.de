<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="ogre_3d_-_3.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>ogre 3d - 3</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/ogre/ogre_3d_-_3.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="a_new_workstation_ii.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="ogre_3d_-_4.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  
      <div id="seriesContainer">
      <a href="timeline.html?filter=series::ogre" title="article series ogre" class="seriesbtn btn btn-primary">ogre</a>
        <header class="seriesHeader">
          <div id="seriesLeft"><a href="ogre_3d_-_2.html"><span class="glyphiconLinkSeries glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article in series"></span>
            </a>   </div>
          <div id="seriesRight">   <a href="ogre_3d_-_4.html">
              <span class="glyphiconLinkSeries glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article in series"></span>
            </a></div>
        </header>
      </div>

  <div class="article">
    <h1 id="SiteTitle">ogre 3d - 3</h1>
    <div id="date"><p><span id="lastupdated">6 mar 2010</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::gentoo" class="tagbtn btn btn-primary">gentoo</a><a href="timeline.html?filter=tag::linux" class="tagbtn btn btn-primary">linux</a><a href="timeline.html?filter=tag::ogre3d" class="tagbtn btn btn-primary">ogre3d</a><a href="timeline.html?filter=tag::technology" class="tagbtn btn btn-primary">technology</a><a href="timeline.html?filter=tag::usability" class="tagbtn btn btn-primary">usability</a></p></div>
    <p><a href="media/linux_tux-svg.png"><img src=media/linux_tux-svg.png alt="" style="float: right" size=300x caption="why ois did not work on my linux installation"></a></p>
<p>#what is ois? i quote [1]:</p>
<p>Object Oriented Input System (OIS) is meant to be a cross platform,
simple solution for using all kinds of Input Devices (KeyBoards, Mice,
Joysticks, etc) and feedback devices (e.g. forcefeedback). Written in
C++ using Object Oriented Design patterns</p>
<p>i’ve finally found out why ois [1] does <strong>not</strong> work
with my linux system. see this:</p>
<pre><code>ls -la /dev/input
crw-r-----  1 root root 13, 73 Feb 28 12:46 event9
crw-r--r--  1 root root 13,  0 Feb 28 12:46 js0</code></pre>
<p>as most linux users will instantly see: js0 can be read but not be
written to. so is this bad? or does this degrade useage? probably it is
not bad since a user might only have to write to a jsX device if it is a
‘force feedback’ supporting device. but for only reading from the device
it should be useable as expected. <strong>but the joystick/gamepad did
not work with OIS</strong> at all, so i wondered why and i started to
look at the code of OIS. i found a ReadMe.txt file with an obsolete
autotools toggle - guess what - i hate autotools.</p>
<p>anyway, the ReadMe.txt states:</p>
<pre><code>./configure --disable-joyevents --- Uses /dev/input/jsX instead of /dev/input/eventX</code></pre>
<p>so i tried –disable-joyevents but it seems that this option is not
used anymore because ./configure complains with:</p>
<pre><code>configure: WARNING: unrecognized options: --disable-joyevents</code></pre>
<p><strong>however, this made me think: what is that event9 device when
plugging in the gamepad</strong> (still the ps3 controller). it is yet
another interface to access the gamepad. so one can either use js0 or
event9 (on my system, since the names are autogenerated by the
system).</p>
<p>after changing the permissions of event9 (as root) with:</p>
<pre><code>chmod 0777 /dev/input/event9</code></pre>
<p><strong>and trying the ois demo again it worked</strong>! no wonder
but took me at least about 1h to find out. so why don’t they try to open
the js0 device? why don’t they complain about permission issues? at
least the console demo application could do that (it can’t since the
input opening and handling is in the linux part of the library anyway)
but what about some lines like:</p>
<pre><code>event1: can&#39;t open device for reading
event2: can&#39;t open device for reading
...
event9: can&#39;t open device for reading</code></pre>
<p>this would be very handy for debugging the situation. or seen from a
different point of view, is this a gentoo issue? is this a udev issue?
why does that device not have read permissions per default? maybe for
securty? how knows…</p>
<h2 data-number="1" id="ois-and-udev">ois and udev</h2>
<p>thanks to [3] i found this handy udevadm command:</p>
<pre><code>udevadm info -a -p  $(udevadm info -q path -n /dev/input/js0)</code></pre>
<p>this can be combined to what i’ve written about udev already at [4].
in short (looking at the output of the above command we search for these
two parameters):</p>
<ul>
<li><p>ATTRS{idVendor}==“054c”</p></li>
<li><p>ATTRS{idProduct}==“0268”</p></li>
</ul>
<p>these two parameters will do the work. so the new udev rule looks
like this:</p>
<pre><code># cat /etc/udev/rules.d/99-myrules.rules
KERNEL==&quot;event[0-9]*&quot;, SYSFS{idVendor}==&quot;054c&quot;, SYSFS{idProduct}==&quot;0268&quot;, MODE=&quot;0666&quot;, GROUP=&quot;games&quot;, SYMLINK+=&quot;eventPS3&quot;
KERNEL==&quot;js[0-9]*&quot;, MODE=&quot;0664&#39;&quot;, GROUP=&quot;games&quot;</code></pre>
<p><strong>WARNING</strong>: i named that file 11-myrules.rules with the
result that the group was changed but never the mode so i wondered why.
later i found out that there is some other rule which had overwritten
the MODE but not the GROUP. (so i renamed it to 99-myrules.rules)
<strong>WARNING</strong>: using 0666 makes the GROUP=“games” useless
since every user can attache that device now, you might want to add your
local user to the ‘games’ group and change MODE=“0660” instead</p>
<p>so after making changes to /etc/udev/rules.d one MUST NOT forget to
do this:</p>
<pre><code>udevadm trigger</code></pre>
<p>this will reload the rules (and one of these rules we just changed).
now replug your gamepad and see if the permissions were changed in
/dev/input, probably with: ‘ls -la /dev/input’</p>
<h2 data-number="2" id="ois-packaging-on-gentoo">ois packaging on
gentoo</h2>
<p>debugging ois is not easy if the software isn’t installed correctly.
that is the case with the linux package since they don’t install</p>
<ul>
<li>ConsoleApp - application to test input devices as
(mouse/keyboard/gamepad/joystick)</li>
<li>FFConsoleTest - probably the same but this time with ‘force
feedback’ support</li>
</ul>
<p>this is again a complaint about package management…</p>
<h2 data-number="3" id="ois-concepts">ois concepts</h2>
<p>ois is designed cross platform which is very good. ogre 3d can use
ois and as far as i can tell the design of ois is sound. it does not
detect my ps3 controller as a ‘force feedback’ device but i can live
with that. what really bugs me is the fact that ois (same goes for
libSDL) does not support device hotplugging - i’ve not tried on windows
but i’m sure of linux and mac (since mac uses libSDL as backend
currently).</p>
<p>every person who has once used a ps3 or a xbox knows how cool device
hotplugging is!</p>
<p>there was a project for sdl to make device hot-plugging for linux
work. however this was - if i recall correctly - not implemented into
the library but instead the library was queried for a list of devices if
the linux hardware abstraction layer (HAL) called a callback via dbus to
notify of device changes. the new device was then opened as any normal
joystick device using sdl.</p>
<p>what i want is different: i don’t want to use dbus in my application.
and i don’t want to code like that. i just want to have a additional
event which informs me about the state-change of currently opened
joysticks (that is for instance js0 which is in use). right after it is
unplugged my callback for new events (same goes if i poll the device
every frame) i will receive the event that the device is now gone so i
can close the device handler and the game could also react to it
probably with a game pause or a screen showing: you don’t have any input
device attached, can’t continue… please attache at least one device.</p>
<p>this way one could also switch from one player to two player mode or
one could display a device manager dialog when plugging a second device…
basically whatever you want to do.</p>
<p>device hotplugging is on the todo list for ‘sdl 1.3’. i wonder when
that is released… (according to [2])</p>
<h2 data-number="4" id="links">links</h2>
<ul>
<li>[1] <a href="http://sourceforge.net/projects/wgois/"
class="uri">http://sourceforge.net/projects/wgois/</a></li>
<li>[2] <a
href="http://lists.libsdl.org/pipermail/sdl-libsdl.org/2009-January/068344.html"
class="uri">http://lists.libsdl.org/pipermail/sdl-libsdl.org/2009-January/068344.html</a></li>
<li>[3] <a href="http://raftaman.net/?p=343"
class="uri">http://raftaman.net/?p=343</a></li>
<li>[4] <a href="http://lastlog.de/wiki/index.php/Udev_permission"
class="uri">http://lastlog.de/wiki/index.php/Udev_permission</a></li>
</ul>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/ogre/ogre_3d_-_3.mdwn" title="posts\ogre\ogre_3d_-_3.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
