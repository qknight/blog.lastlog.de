<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="uninterruptible_power_supply_suspend2ramsuspend2disk.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>uninterruptible power supply suspend2ramsuspend2disk</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/uninterruptible_power_supply_suspend2ramsuspend2disk.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="linux_love_gentoo_love.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="n0_netw0rk_manager.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  

  <div class="article">
    <h1 id="SiteTitle">uninterruptible power supply suspend2ramsuspend2disk</h1>
    <div id="date"><p><span id="lastupdated">23 nov 2009</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::gentoo" class="tagbtn btn btn-primary">gentoo</a><a href="timeline.html?filter=tag::linux" class="tagbtn btn btn-primary">linux</a><a href="timeline.html?filter=tag::technology" class="tagbtn btn btn-primary">technology</a><a href="timeline.html?filter=tag::usability" class="tagbtn btn btn-primary">usability</a></p></div>
    <h2 data-number="1" id="motivation">motivation</h2>
<p>Using software raids on linux ‘<strong>mdadm</strong>’ is problematic
if you hit a ‘power outage’. Using a single device without a ‘software
raid’ is not a problem since it uses a journal -
<strong>ext3++/xfs</strong> for instance are quite stable in this
regard. This is probably also true when using <strong>LVM</strong> - the
‘logical volume manager’ (but don’t quote me there, my LVM ‘use case’
might differ from yours).</p>
<h2 data-number="2" id="introduction">introduction</h2>
<p>Using the same filesystems with a <strong>software raid</strong>
**makes the ‘journal’ useless, see [1] and [2]. Let’s quote [2]:</p>
<blockquote>
<p><strong>Power Loss and Ensuing Data Corruption</strong> Many
beginners think that they can test RAID by starting a disk-access
intensive job, and then unplugging the power while it is running. This
is usually guaranteed to cause some kind of data corruption, and RAID
does nothing to prevent it or to recover the resulting lost data. This
kind of data corruption/loss can be avoided by using a journaling file
system, and/or a journaling database server (to avoid data loss in a
running SQL server when the system goes down). In discussions of
journaling, there are typically two types of protection that can be
offered: journaled meta-data, and journaled (user’s) data. The term
“meta-data” refers to the file name, the file owner, creation date,
permissions, etc., whereas “data” is that actual contents of the file.
By journaling the meta-data, a journaling file system can guarantee fast
system boot times, by avoiding long integrity checks during boot.
However, journaling the meta-data does not prevent the contents of the
file from getting scrambled. Note that most journaling file systems
journal only the meta-data, and not the data. (Ext3fs can be made to
journal data, but at a tremendous performance loss). Note that databases
have their own unique ways of guaranteeing data integrity in the face of
power loss or system crash.</p>
</blockquote>
<h2 data-number="3" id="new-ideas">new ideas</h2>
<p>Normally one would use a ‘UPS’ to shut down the system properly. But
looking at my two <strong>c2c</strong> intel archs and my
<strong>32bit</strong> intel laptop, I wonder how long this scenario
will remain to be a ‘default’.</p>
<p>I’d expect suspend2ram or suspend2disk becoming a new way doing
things better. Say the power outage is just 3minutes. Your suspend2ram
takes <strong>5secs</strong>, resume <strong>7secs</strong> some users
might not even notice your system was down.</p>
<p>But if the power outage was say <strong>1-3hours </strong>and the
system consumes <strong>3W</strong> of power you would need no powerful
system. Say you use suspend2disk by default you can completely shutdown
the system. A battery would have to stand the peak power usage of
<strong>130W</strong> for about <strong>7 secs</strong> (this is just a
guess, say c2c processor, several network cards, 4 3,5” harddrives
(<strong>10W</strong>) each.</p>
<p>I have two <strong>low power gentoo fileservers</strong>, both need
less than <strong>35W</strong> and both use a different technology.</p>
<ul>
<li>VIA board with a VIA Nehemiah processor (tested using
2.6.24-tuxonice-r4)</li>
<li>Intel board with Intel(R) Atom(TM) (untested)</li>
</ul>
<p>The <strong>VIA board was</strong> already <strong>tested</strong>
for <strong>support of suspend2ram/suspend2disk</strong> with great
<strong>success</strong>(and I don’t mean standby). I did not test the
Intel board, but I’d expect it to work as well. You might wonder why I
tested suspend2disk in the first place - this was not to check for power
outage capabilities! I usually have no screen attached to the computer
and it is located in a very uncomfortable location. When something goes
wrong - for example I shut down the network by fault and I don’t want to
shut down the system I can suspend2disk this machine pressing the power
button. Next I pick that box up and put it on a desk and resume it with
a screen attached. This works fine - trust me on that.</p>
<p>On the other hand I don’t use a ‘<strong>software raid</strong>’ in
these systems so ‘<strong>a power fail is not a problem at
all</strong>’. I just wanted to bring up the idea - maybe someone
already uses this the way I proposed?!</p>
<h2 data-number="4" id="links">links</h2>
<ul>
<li>[1] <a href="http://tldp.org/HOWTO/Software-RAID-0.4x-HOWTO-4.html"
class="uri">http://tldp.org/HOWTO/Software-RAID-0.4x-HOWTO-4.html</a></li>
<li>[2] <a href="http://linas.org/linux/raid.html"
class="uri">http://linas.org/linux/raid.html</a></li>
</ul>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/uninterruptible_power_supply_suspend2ramsuspend2disk.mdwn" title="posts\uninterruptible_power_supply_suspend2ramsuspend2disk.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
