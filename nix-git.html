<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="nix-git.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>nix-git</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/nix-git.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="shinken_1.2.4_on_ubuntu_desktop_12.10_iv.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="infotainment.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  

  <div class="article">
    <h1 id="SiteTitle">nix-git</h1>
    <div id="date"><p><span id="lastupdated">26 jul 2013</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::nixos" class="tagbtn btn btn-primary">nixos</a><a href="timeline.html?filter=tag::linux" class="tagbtn btn btn-primary">linux</a><a href="timeline.html?filter=tag::github" class="tagbtn btn btn-primary">github</a></p></div>
    <p><a href="media/nixos-lores.png"><img src=media/nixos-lores.png style="float: right" alt=""></a></p>
<h2 data-number="1" id="motivation">motivation</h2>
<p>the checkout of nixpkgs usually takes very long but we can’t do
anything about it since the command to compress the repository needs to
be ran on the remote repository. as we were discussing this already, the
checkout size could be cut by half, which is very good.</p>
<h2 data-number="2" id="discussion">discussion</h2>
<p>[1] metiones that:</p>
<blockquote>
<p><strong>The remote repo should be configured to run gc as needed
after a commit is made. See the documentation of gc.auto in git-gc and
git-config man pages.</strong></p>
<p>However, a remote repo shouldn’t need all that much garbage
collection, since it will rarely have dangling (unreachable) commits.
These usually result from things like branch deletion and rebasing,
which typically happen only in local repos.</p>
<p>So gc is needed more for repacking, which is for saving storage space
rather than removing actual garbage. The gc.auto variable is sufficient
for taking care of this.</p>
</blockquote>
<p>[2] says: &gt; From the git-gc man page: &gt; &gt; Users are
encouraged to run this task on a regular basis within each repository to
maintain good disk space utilization and good operating performance.
&gt; &gt; Emphasis mine. Bare repositories are repositories too! &gt;
&gt; <strong>Further explanation: one of the housekeeping tasks that
git-gc performs is packing and repacking of loose objects. Even if you
never have any dangling objects in your bare repository, you will – over
time – accumulate lots of loose objects. These loose objects should
periodically get packed, for efficiency. Similarly, if a large number of
packs accumulate, they should periodically get repacked into larger
(fewer) packs.</strong></p>
<h2 data-number="3" id="statistics">statistics</h2>
<h3 data-number="3.1" id="nixpkgs">nixpkgs</h3>
<pre><code>joachim@lenovo-t530 /tmp/ % git clone git@github.com:NixOS/nixpkgs.git

joachim@lenovo-t530 /tmp/nixpkgs (git)-[master] % du -sh .
250M    .

joachim@lenovo-t530 /tmp/nixpkgs (git)-[master] % git gc --aggressive
Counting objects: 253187, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (230102/230102), done.
Writing objects: 100% (253187/253187), done.
Total 253187 (delta 175779), reused 67451 (delta 0)
Checking connectivity: 253187, done.
git gc --aggressive  242.33s user 4.53s system 517% cpu 47.712 total

joachim@lenovo-t530 /tmp/nixpkgs (git)-[master] % du -sh .
139M    .</code></pre>
<h3 data-number="3.2" id="nixos">nixos</h3>
<pre><code>joachim@lenovo-t530 /tmp/ % git clone git@github.com:NixOS/nixos.git

joachim@lenovo-t530 /tmp/nixos (git)-[master] % du -sh .
15M     .

joachim@lenovo-t530 /tmp/nixos (git)-[master] % git gc --aggressive
Counting objects: 31750, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (31432/31432), done.
Writing objects: 100% (31750/31750), done.
Total 31750 (delta 23940), reused 7545 (delta 0)
git gc --aggressive  14.27s user 0.54s system 536% cpu 2.762 total

joachim@lenovo-t530 /tmp/nixos (git)-[master] % du -sh
7.7M    .</code></pre>
<h3 data-number="3.3" id="nix">nix</h3>
<pre><code>joachim@lenovo-t530 /tmp/ % git@github.com:NixOS/nix.git

joachim@lenovo-t530 /tmp/nix (git)-[master] % du -sh .
17M     .

joachim@lenovo-t530 /tmp/nix (git)-[master] % git gc --aggressive
Counting objects: 24178, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (23901/23901), done.
Writing objects: 100% (24178/24178), done.
Total 24178 (delta 18644), reused 5345 (delta 0)
git gc --aggressive  17.91s user 0.45s system 524% cpu 3.497 total

joachim@lenovo-t530 /tmp/nix (git)-[master] % du -sh .
7.8M    .</code></pre>
<h2 data-number="4" id="what-to-do-now">what to do now?</h2>
<p>with some luck someone at support@github.com will run: git gc
–aggressive for nixpkgs.git from time to time just to keep compression
at a good level.</p>
<h2 data-number="5" id="links">links</h2>
<ul>
<li>[1] <a
href="http://stackoverflow.com/questions/3162786/how-to-do-git-gc-on-git-remote-repository"
class="uri">http://stackoverflow.com/questions/3162786/how-to-do-git-gc-on-git-remote-repository</a></li>
<li>[2] <a
href="http://stackoverflow.com/questions/3532740/do-i-ever-need-to-run-git-gc-on-a-bare-repo"
class="uri">http://stackoverflow.com/questions/3532740/do-i-ever-need-to-run-git-gc-on-a-bare-repo</a></li>
</ul>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/nix-git.mdwn" title="posts\nix-git.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
