<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="tinkerforge_relais_raspberry_pi_2.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>tinkerforge relais raspberry pi 2</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/tinkerforge_relais_raspberry_pi_2.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="nixos_option_search.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="PyQwt_on_github.com.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  
      <div id="seriesContainer">
      <a href="timeline.html?filter=series::illuminator" title="article series illuminator" class="seriesbtn btn btn-primary">illuminator</a>
        <header class="seriesHeader">
          <div id="seriesLeft"><a href="tinkerforge_relais_raspberry_pi.html"><span class="glyphiconLinkSeries glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article in series"></span>
            </a>   </div>
          <div id="seriesRight"></div>
        </header>
      </div>

  <div class="article">
    <h1 id="SiteTitle">tinkerforge relais raspberry pi 2</h1>
    <div id="date"><p><span id="lastupdated">10 dec 2014</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::raspberrypi" class="tagbtn btn btn-primary">raspberrypi</a><a href="timeline.html?filter=tag::tinkerforge" class="tagbtn btn btn-primary">tinkerforge</a><a href="timeline.html?filter=tag::linux" class="tagbtn btn btn-primary">linux</a><a href="timeline.html?filter=tag::usability" class="tagbtn btn btn-primary">usability</a><a href="timeline.html?filter=tag::node.js" class="tagbtn btn btn-primary">node.js</a></p></div>
    <p><a href="media/tinkerforge-logo.jpg"><img src=media/tinkerforge-logo.jpg style="float: right"></a></p>
<h2 data-number="1" id="motivation">motivation</h2>
<p>i’ve upgraded my illuminator installation, see previous post: <a
href="http://blog.lastlog.de/posts/tinkerforge_relais_rapspberry_pi/index.html"
class="uri">http://blog.lastlog.de/posts/tinkerforge_relais_rapspberry_pi/index.html</a>.
in short that is:</p>
<ul>
<li>added another <strong>‘master brick’</strong></li>
<li>upgraded from 3 to 4 <strong>‘dual relay bricklet’</strong></li>
<li>added <strong>IO-16 bricklet</strong></li>
<li>added <strong>distance IR bricklet</strong></li>
<li>added <strong>Ralink RT2571W</strong></li>
<li>added <strong>8 hardware buttons</strong></li>
<li>adapted the relais.js software</li>
</ul>
<p>the main reason for this upgrade was that the used <strong>‘multi
touch bricklet’ was very very sensitive to toggling the state by
touching not only the control field, which would have been what one
excpets, but even by touching the cables connecting the bricklet with
the multi touch field. this often resulted in unwanted toggling of
devices - and since these are 230V i didn’t want that to happen at
all.</strong></p>
<p><a href="media/tinkerforge/button-bar-front.jpg"><img src=media/tinkerforge/button-bar-front.jpg style="float: none" size=700x caption="the interface with the 8 buttons"></a></p>
<font color="red">
<hr>
<p>WARNING - DISCLAIMER:</p>
<p>i’m no expert in electrical engineering - so if you copy this work,
ask an expert to check on your setup before making daily use. especially
check these things: ***</p>
<ul>
<li><strong>i’m no tinkerforge expert</strong>, check your facts!</li>
<li><strong>do not work with 230V unless you really know what you are
doing, it can kill</strong></li>
<li><strong>ensure that the electrical load you are working with does
not exceed given relais parameters</strong></li>
<li><strong>add a filter so that a single relais isn’t toggled more than
10/min</strong> and disable the control on bursts</li>
<li>consider adding a <a
href="https://en.wikipedia.org/wiki/Residual-current_device"
class="uri">https://en.wikipedia.org/wiki/Residual-current_device</a></li>
<li>this device is running in my LAN, do <strong>not expose it to the
internet without further security additions</strong></li>
<li>consider running the node application <strong>as a normal user and
not as root</strong> as i do</li>
</ul>
<p>in fact, i’ve chosen tinkerforge dual relais bricklets over a
self-built relais to avoid making critical errors which could result in
your house burned to the ground or lives put to danger.</p>
I’M NOT RESPONSIBLE IF YOUR DEVICE KILLS YOUR CAT OR BURNS DOWN YOUR
HOUSE - YOU HAVE TO KNOW WHAT YOU ARE DOING!
<hr>
<p></font></p>
<h2 data-number="2" id="hardware-setup">hardware setup</h2>
<h3 data-number="2.1" id="new-interface-with-8-buttons">new interface
with 8 buttons</h3>
<p><a href="media/tinkerforge/button-bar-internals.jpg"><img src=media/tinkerforge/button-bar-internals.jpg style="float: none" size=700x caption="internals of the interface"></a></p>
<h3 data-number="2.2" id="lightbox-updated">lightbox updated</h3>
<pre><code>|- raspberry pi B+
 |- masterbrick 
  |A- dual relias bricklet (2x 230V relais)
  |B- dual relias bricklet (2x 230V relais)
  |C- dual relias bricklet (2x 230V relais)
  |D- dual relias bricklet (2x 230V relais)
 |- masterbrick 
  |A- IO-16 bricklet
  |B- distance IR bricklet
 |- Ralink RT2571W (WLAN AP using hostapd)
    Bus 001 Device 004: ID 050d:705a Belkin Components F5D7050 Wireless G Adapter v3000 [Ralink RT2571W]</code></pre>
<p><a href="media/tinkerforge/lightbox-updated.jpg"><img src=media/tinkerforge/lightbox-updated.jpg style="float: none" size=700x caption="lightbox extend by WIFI and raspberry pi B+"></a></p>
<h4 data-number="2.2.1" id="raspberry-pi-b-hardware-upgrade">raspberry
pi B+ hardware upgrade</h4>
<p>the B+ is really worth every cent. i love that it has 4 USB ports now
and that it won’t ‘reboot’ when unplugging a USB plug, which the
raspberry pi B always did. while the raspberry pi B could be powered
over the 2 USB ports (not using the mini USB port intented for powering
it) this was not true for the B+. my new ‘hack’ is to connect the power
to the R-PI GPIO pins and on the USB side at the same time. this seems
to work (don’t know if it hurts the PI so - be careful). you can see
this ‘fix’ in the pictures.</p>
<h4 data-number="2.2.2" id="power-usage">power usage</h4>
<p>my measurements are not as accurate but give you an overview:</p>
<ul>
<li>~2W = (230V to usb converter) + raspberry pi B+ + 2x tinkerforge
master brick</li>
<li>additionally: 0,4W per triggered relais, that is: 6 x 0,4 = 2,4W
additional load (peak)</li>
<li>additionally: 2,6W for the WLAN USB module</li>
</ul>
<p><strong>overall power consumption is between ~3,8W and ~5,4W
(including the USB power supply), which isn’t bad!</strong></p>
<h4 data-number="2.2.3" id="wireless-access-point">wireless access
point</h4>
<p>i was following the guide at [7] and [8] to get the AP working:</p>
<p>my <strong>/etc/network/interfaces</strong> configuration:</p>
<pre><code>auto lo
iface lo inet loopback

auto br0
iface br0 inet dhcp
        bridge_fd 1
        bridge_hello 3
        bridge_maxage 10
        bridge_stp off
        bridge_ports eth0 wlan0
allow-hotplug eth0
iface eth0 inet manual

allow-hotplug wlan0
iface wlan0 inet manual</code></pre>
<p>my <strong>hostapd.conf</strong> configuration:</p>
<pre><code>interface=wlan0
driver=nl80211
#ieee80211n=1
bridge=br0
country_code=NZ
ctrl_interface=wlan0
ctrl_interface_group=0
ssid=bar
hw_mode=g
channel=1
wpa=3
wpa_key_mgmt=WPA-PSK
wpa_passphrase=12345678
wpa_pairwise=TKIP
rsn_pairwise=CCMP

beacon_int=100
auth_algs=3
macaddr_acl=0
wmm_enabled=1
eap_reauth_period=360000000
eapol_version=1
logger_syslog=-1
logger_syslog_level=2</code></pre>
<p>this works very well with android and my linux based laptop. someone
had problems connecting to it using windows 7 though.</p>
<pre><code># lsusb
Bus 001 Device 004: ID 050d:705a Belkin Components F5D7050 Wireless G Adapter v3000 [Ralink RT2571W]</code></pre>
<p><a href="media/tinkerforge/Ralink-RT2571W.jpg"><img src=media/tinkerforge/Ralink-RT2571W.jpg style="float: none" size=500x caption="good hardware for AP mode using hostapd - Ralink-RT2571W"></a></p>
<p>note: initially i tried two realtek based adapters, both worked to a
certain degree but failed as access point, as my connection would drop
the wpa_supplicant subscripted client, when watching youtube videos or
similar things involving big data rates. others seem to have problems as
well, see discussion at [2]. i tried to debug this for a while but the
problem seems to be in the driver.</p>
<p><a href="media/tinkerforge/Realtek-RTL8188CUS.jpg"><img src=media/tinkerforge/Realtek-RTL8188CUS.jpg style="float: none" size=300x caption="bad hardware for AP mode using hostapd - Realtek-RTL8188CU and Realtek-RTL8188CUS"></a></p>
<h4 data-number="2.2.4"
id="raspberry-pi---rs232-serial-interface">raspberry pi - RS232 Serial
Interface</h4>
<p>oh, and i bought a ‘PL2303HX USB to TTL to UART RS232 COM Cable
module Converter’ [3] which is really helpful when debugging the boot
process of the pi.</p>
<p>note: i initially had issues copying the SD card to the micro SD card
using the linux tool dcfldd [4] (similar to ‘dd’) and the serial
interface was showing the problem and i didn’t have to connect any HDMI
cable.</p>
<p>i usually love to use picocom [5]:</p>
<pre><code>picocom /dev/ttyUSB0 -b 115200 -l</code></pre>
<h3 data-number="2.3" id="avahi">avahi</h3>
<p>i also installed avahi on the pi, now i can just type:</p>
<p><a href="http://rasbperrypi.local"
class="uri">http://rasbperrypi.local</a> into the browser, no matter
what IP was assigned to the pi.</p>
<p>note: the name could be changed by changing the hostname
(/etc/hostname) on the raspberry pi, but i like it to be
rasbperrypi.</p>
<p>note: this does not work with android, as they don’t ship avahi and i
couldn’t find any convenient way of installing it on android. one
workaround would be to integrate avahi into your router but i don’t have
access to the DNS on that device so only my linux running computers
benefit from it.</p>
<h2 data-number="3" id="inkscape-with-box-maker-extension">inkscape with
box maker extension</h2>
<p>the box was designed with the box maker extension [11] for
inkscape.</p>
<h2 data-number="4" id="conclusion">conclusion</h2>
<p>this hardware upgrade was really worth it. i was using a laser cutter
at the shack space in stuttgart [9] which is really a nice place and it
was interesting to work with this tool [10]. thanks to robert tagscherer
for his help with everything!</p>
<p>usability increased in many regards!</p>
<h2 data-number="5" id="links">links</h2>
<ul>
<li>[1] <a href="http://www.tinkerforge.com/"
class="uri">http://www.tinkerforge.com/</a></li>
<li>[2] <a
href="http://www.linuxine.com/story/raspberry-pi-edimax-wlan-stick-drops-connection"
class="uri">http://www.linuxine.com/story/raspberry-pi-edimax-wlan-stick-drops-connection</a></li>
<li>[3] <a
href="http://www.savagehomeautomation.com/projects/raspberry-pi-rs232-serial-interface-options-revisit.html"
class="uri">http://www.savagehomeautomation.com/projects/raspberry-pi-rs232-serial-interface-options-revisit.html</a></li>
<li>[4] <a href="http://dcfldd.sourceforge.net/"
class="uri">http://dcfldd.sourceforge.net/</a></li>
<li>[5] <a href="https://code.google.com/p/picocom/"
class="uri">https://code.google.com/p/picocom/</a></li>
<li>[6] <a href="https://en.wikipedia.org/wiki/Avahi_(software)"
class="uri">https://en.wikipedia.org/wiki/Avahi_(software)</a></li>
<li>[7] <a
href="http://www.raspberrypi.org/forums/viewtopic.php?f=36&amp;t=8861"
class="uri">http://www.raspberrypi.org/forums/viewtopic.php?f=36&amp;t=8861</a></li>
<li>[8] <a
href="http://blog.skufel.net/2014/11/ho-to-use-raspberry-pi-as-wireless-access-point/"
class="uri">http://blog.skufel.net/2014/11/ho-to-use-raspberry-pi-as-wireless-access-point/</a></li>
<li>[9] <a href="http://shackspace.de/"
class="uri">http://shackspace.de/</a></li>
<li>[10] <a href="http://shackspace.de/wiki/doku.php?id=lasercutter"
class="uri">http://shackspace.de/wiki/doku.php?id=lasercutter</a></li>
<li>[11] <a
href="http://hackaday.com/2012/07/26/box-maker-extension-for-inkscape/"
class="uri">http://hackaday.com/2012/07/26/box-maker-extension-for-inkscape/</a></li>
</ul>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/tinkerforge_relais_raspberry_pi_2.mdwn" title="posts\tinkerforge_relais_raspberry_pi_2.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
