<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="a_new_workstation_iii.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>a new workstation iii</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/a_new_workstation/a_new_workstation_iii.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="prove_binary_deployment_by_recompiling_and_comparing.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="evopedia_is_running_on_mac_os_x.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  

  <div class="article">
    <h1 id="SiteTitle">a new workstation iii</h1>
    <div id="date"><p><span id="lastupdated">20 feb 2011</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::gentoo" class="tagbtn btn btn-primary">gentoo</a><a href="timeline.html?filter=tag::linux" class="tagbtn btn btn-primary">linux</a><a href="timeline.html?filter=tag::usability" class="tagbtn btn btn-primary">usability</a></p></div>
    <p><a href="media/hp-com-elitebook-8530w.jpg"><img src=media/hp-com-elitebook-8530w.jpg alt="source hp.com" style="float: right" size=300x></a></p>
<h2 data-number="1" id="nvidia-and-the-proprietary-driver">nvidia and
the proprietary driver</h2>
<p><strong>well, how to say it politely: proprietary driver, go to
hell</strong>! lately i’ve been using
=x11-drivers/nvidia-drivers-260.19.29 with:</p>
<ul>
<li>NX <strong>(N</strong>o e<strong>X</strong>ecute bit)</li>
<li>VT (<strong>virtualization bit) </strong></li>
</ul>
<p>enabled/disabled in various combinations but the laptop was crashing
all over the place, that includes:</p>
<ul>
<li>rendering a webpage (sometimes)</li>
<li>playing flash videos (youtube)</li>
<li>rendering a pdf (using kile)</li>
<li>resume cycle (after pm-suspend)</li>
</ul>
<p>i probably had <strong>2-6 crashes per day at least</strong>. but on
the bright side i <strong>did not have much file loss</strong> because i
migrated from <strong>xfs to ext3!</strong></p>
<p><strong>i’ve had issues with this since i bought the laptop!
</strong></p>
<h2 data-number="2" id="tracking-down-the-problem">tracking down the
problem:</h2>
<p>i’ve been experimenting with
‘<strong>/usr/src/linux/Documentation/networking/netconsole.txt</strong>’
which is a very very <strong>important tool when tracking down kernel
related issues</strong>. before KMS + nouveau + gallium3d a kernel crash
would not ‘bluescreen’ on linux when using the old driver architecture.
KMS makes this possible now.</p>
<p>back then i was using the nvidia.ko driver, so i create a little
setup to track down the problem:</p>
<h3 data-number="2.1" id="on-the-remote-machine">on the remote
machine</h3>
<p>setup here is pretty easy, <strong>inside a screen console, issue
this command</strong>:</p>
<pre><code>nc -l -u -p 6666</code></pre>
<p>or</p>
<pre><code>nc -l -u -p 6666 | tee ~/netconsole.log</code></pre>
<p>using screen makes it easy to retrieve the error log later for saving
it to a file.</p>
<h3 data-number="2.2" id="on-the-laptop">on the laptop</h3>
<p><strong>start that script</strong> every new boot as root:</p>
<pre><code>ip a del 192.168.100.233/24 dev eth0
ip a add 192.168.100.233/24 brd 192.168.100.255 dev eth0

rmmod netconsole
sleep 1
dmesg -n 8

modprobe netconsole netconsole=4444@192.168.100.233/eth0,6666@192.168.100.10/00:64:18:34:13:63</code></pre>
<p>syntax:</p>
<p>netconsole=[src-port]@[src-ip]/[<dev>],[tgt-port]@<tgt-ip>/[tgt-macaddr]</p>
<pre><code>where
  src-port      source for UDP packets (defaults to 6665)
  src-ip        source IP to use (interface address)
  dev           network interface (eth0)
  tgt-port      port for logging agent (6666)
  tgt-ip        IP address for logging agent
  tgt-macaddr   ethernet MAC address for logging agent (broadcast)</code></pre>
<p>note: <strong>dmesg -n 8</strong> is very important!</p>
<h3 data-number="2.3" id="the-log">the log</h3>
<p>right after you start the script on the laptop** this (or similar)
should appear**:</p>
<pre><code>netconsole: network logging started
netconsole: local port 4444
netconsole: local IP 192.168.100.233
netconsole: interface &#39;eth0&#39;
netconsole: remote port 6666
netconsole: remote IP 192.168.100.10</code></pre>
<p>if not, then something is wrong! check that the connection works by
using this command:</p>
<pre><code>echo -n &quot;hello world&quot; | nc -u 192.168.100.10 6666</code></pre>
<p>but notice:</p>
<p>the nc receiver will attach to one source port number. so if you run
that echo, it will attach to that source port number and then it will
ignore anything coming from netconsole (another source port number)</p>
<p><strong>therefore restart nc on the remote machine.</strong></p>
<h3 data-number="2.4" id="the-outcome">the outcome</h3>
<p>the problem for me was that** i wasn’t able to record any nvidia
related bug as it was probably a hardlock**, i did not try to use the
‘sys key’ but it would have been a good idea. the logging works for some
‘suspend/resume issues’.</p>
<p>Note: <strong>use the ethernet devices</strong>, it does not work
with the wireless lan devices!</p>
<h2 data-number="3" id="the-solution-to-the-nvidia.ko-problem">the
solution to the nvidia.ko problem</h2>
<p>since yesterday i’m using
<strong>=x11-drivers/xf86-video-nouveau-0.0.16_pre20101130 for
2d</strong> (3d does not work yet). a friend with the same laptop
reported that on his debian machine also 3d support is working. so far i
only had one crash after 7x suspend/resume cycling. this is very good as
it makes working with that computer now possible. 3d support as running
<strong>=x11-apps/mesa-progs-8.0.1 glxgears/glxinfo </strong>only
produces a black window which seems to do nothing. at least 3d does not
‘segfault’ the application using it as yesterday before i did: ‘emerge
-uDN world’ properly.</p>
<h3 data-number="3.1" id="the-first-blue-screen-in-linux">the first
‘blue screen’ in linux</h3>
<p>‘blue screens’ on linux are actually ‘black screens’ and it is
finally working which is a very good thing. still i did not understand
why my laptop was crashing after the 7th resume cycle. i have to learn
how to interpret such a trace ;-). at least i got a backtrace in
comparison to the netconsole approch (using the nvidia.ko driver).</p>
<h3 data-number="3.2" id="nouveau-driver-status">nouveau driver
status</h3>
<p>last time i tried to install the nouveau driver on my gentoo based
laptop i had many troubles. this time i only emerged a few packages as
x11-drivers/xf86-video-nouveau and it was working after i blacklisted
the nvidia module and adapted my xorg.conf to use nouveau by deleting
it.</p>
<p><strong>2d performance is really good and power saving seems to be
implemented now</strong> as the fan gets very silent now. not quite as
silent compared to the nvidia.ko driver but much much better compared to
the last time i tried nouveau.</p>
<p>there are <strong>not 2d drawing artefacts anymore</strong> and
<strong>scrolling in the browser is very performant</strong> and feels
good.</p>
<p>i’m using a setup where <strong>both NX and VT are enabled and
working</strong>. all my virtual machines using virtualbox are
running.</p>
<p><strong>suspend/resume does not work 100% well as the screen
brightness is setup to the minimum level after resume and it can not be
changed so far</strong>.</p>
<h2 data-number="4" id="summary">summary</h2>
<p>i think that x11-drivers/nvidia-drivers finally bites the dust for
several reasons:</p>
<ul>
<li><strong>nvidia.ko seems to be unmaintained</strong> for the 01:00.0
VGA compatible controller: nVidia Corporation G96M [Quadro FX 770M] (rev
a1) card at least</li>
<li><strong>proprietary driver quality was never very good</strong> for
the G96M Quadro FX 770M on the hp 8530w as i was blogging quite a lot
about significant issues</li>
<li><strong>even though it was never very good support seems to degrade
lately</strong></li>
<li><strong>KMS+nouveau+gallium3d is the way to go</strong>, what works
so far looks promising</li>
</ul>
<p><strong>thanks to all developers of nouveau</strong> to make this
possible! i owe you one!!</p>
<p><strong>Edit</strong>: some updates as:</p>
<ul>
<li>there are some 2d drawing issues where icons look like defective
frames of an incomplete mpeg video download</li>
<li>some 2d drawing issues where some regions are drawn wrong</li>
</ul>
<p>i guess both things are related to caching done wrongly</p>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/a_new_workstation/a_new_workstation_iii.mdwn" title="posts\a_new_workstation\a_new_workstation_iii.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
