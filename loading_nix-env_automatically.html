<!DOCTYPE html>
<!-- this document is auto-generated from pankat document editor -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head data-article-dst-filename="loading_nix-env_automatically.html">

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>loading nix-env automatically</title>

<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/jquery.tocify.min.js"></script>

<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />



<script src="js/reconnecting-websocket.min.js"></script>
<script src="js/pankat-websocket.js"></script>
<script src="js/diffDOM.js"></script>


<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/bootstrap.min.js"></script>

<script src="js/anchor.min.js"></script>

<link rel="icon" href="media/favicon.ico" type="image/x-icon" />


<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="css/pandoc-kate.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>
<body>

<div id="toc"></div>

<!-- menu begins -->
<div class="container">
  <nav class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">lastlog.de/blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="timeline.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> timeline</a></li>
        <li><a href="about.html"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> about</a></li>
        <li><a href="/draft" id="draft" style="display: none"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> draft</a></li>
        <li><a href="/draft?article=posts/roadmap.mdwn" id="roadmap" style="display: none"><span class="glyphicon glyphicon glyphicon-road" aria-hidden="true"></span> roadmap</a></li>

      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a title="live updates of article updates on posts/loading_nix-env_automatically.mdwn" id="websocket" style="display: none"><span id="websocketStatus" class="glyphicon glyphicon-remove" aria-hidden="true"></span> websocket</a></li>
        <!-- <li><a href="#">Login</a></li> -->
      </ul>

      <!--<div id="right">
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
        </form>
      </div>-->
    </div><!-- /.navbar-collapse -->
  </nav>

<div id="headerAndArticle">


  <div id="headerContainer">
    <header class="header"><span id="articleNavLeft"> <a href="infotainment.html"> 
      <span class="glyphiconLink glyphicon glyphicon-chevron-left" aria-hidden="true" title="previous article"> </span> prev. article
    </a> </span><span id="articleNavRight"><a href="advanced_webservices_on_nixos.html"> 
        next article <span class="glyphiconLink glyphicon glyphicon-chevron-right" aria-hidden="true" title="next article"></span>
    </a> </span></header>
  </div>
  

  <div class="article">
    <h1 id="SiteTitle">loading nix-env automatically</h1>
    <div id="date"><p><span id="lastupdated">1 aug 2013</span></p></div><div id="tags"><p><a href="timeline.html?filter=tag::nixos" class="tagbtn btn btn-primary">nixos</a><a href="timeline.html?filter=tag::usability" class="tagbtn btn btn-primary">usability</a><a href="timeline.html?filter=tag::packagemanager" class="tagbtn btn btn-primary">packagemanager</a></p></div>
    <p><a href="media/nixos-lores.png"><img src=media/nixos-lores.png alt="" style="float: right"></a></p>
<h2 data-number="1" id="motivation">motivation</h2>
<p>using my-env you create a custom environment, see [1] where you will
find a ~/.nixpkgs/config.nix example script. a couple of times i was
discussing with others that it would be cool to have that environment
loaded automatically when entering that directory. some say that the
ruby devs did astonishing things in that regard. reading [2] finally
inspired me to write this example how this could be done.</p>
<p>so assuming you have installed ‘nix-env -i env-sdl’, this posting
describes what to do in order to get it loaded automatically.</p>
<h2 data-number="2" id="the-shell-extensions">the shell
extension(s)</h2>
<h3 data-number="2.1" id="default-shell-cd-overloading">default shell
(cd overloading)</h3>
<p>i put this into my <strong>~/.zshrc</strong>:</p>
<pre><code>function cd {
    # loads environments automatically when .load-env file exists with the project name &lt;name&gt; in it
    # load-env-&lt;name&gt; must of course exist, example: load-env-sdl where .load-env would contain sdl
    builtin cd &quot;$@&quot;
    if [ -f &quot;.load-env&quot; ] ; then
        echo &quot;Note: found &#39;.load-env&#39; file, automatically loading the &#39;load-env-${a}&#39; environment.&quot;
        # display its contents
        a=$(cat .load-env) 
        load-env-${a}
        echo &quot;Note: You left the &#39;load-env-${a}&#39; environment. Type: load-env-${a} to reload it&quot;
    fi
}</code></pre>
<p>afterwards type:</p>
<pre><code>zsh</code></pre>
<h3 data-number="2.2" id="load-env-sdl-shell">load-env-sdl shell</h3>
<p>to make changes to the spawned shell, edit
$NIXREPOS/nixpkgs/pkgs/misc/my-env/default.nix</p>
<h2 data-number="3" id="usage">usage</h2>
<h3 data-number="3.1" id="to-load-the-environment-manually">to load the
environment manually:</h3>
<pre><code>% load-env-sdl
env-sdl loaded
 
sdl:[joachim@lenovo-t530:~/projects/myproject]$ </code></pre>
<h3 data-number="3.2"
id="to-add-a-environemnt-loader-when-entering-the-directory">to add a
environemnt loader when entering the directory:</h3>
<pre><code>% cd ~/projects/myproject
% echo &quot;sdl&quot; &gt; .load-env</code></pre>
<p>this creates a .load-env file containing ‘sdl’ in it.</p>
<h3 data-number="3.3"
id="afterwards-the-environment-should-be-loaded-automatically-when-entering-projectsmyproject">afterwards
the environment should be loaded automatically when entering
~/projects/myproject</h3>
<pre><code>% cd ~/projects/myproject
env-sdl loaded
 
sdl:[joachim@lenovo-t530:~/projects/myproject]$ </code></pre>
<h2 data-number="4" id="summary">summary</h2>
<p>there is currently no support for environment nesting but i doubt
this is needed anyway. whenever you <strong>want to leave the
environment</strong> simply type ‘<strong>exit</strong>’ or hit
‘<strong>ctrl+d</strong>’.</p>
<h2 data-number="5" id="update-10.7.2014">update 10.7.2014</h2>
<p>see also [3]</p>
<h2 data-number="6" id="links">links</h2>
<ul>
<li>[1] <a href="https://nixos.org/wiki/Howto_develop_software_on_nixos"
class="uri">https://nixos.org/wiki/Howto_develop_software_on_nixos</a></li>
<li>[2] <a
href="http://superuser.com/questions/283352/how-do-you-run-a-shell-command-script-automatically-when-entering-cd-ing-a-direc"
class="uri">http://superuser.com/questions/283352/how-do-you-run-a-shell-command-script-automatically-when-entering-cd-ing-a-direc</a></li>
<li>[3] <a href="https://news.ycombinator.com/item?id=7958388"
class="uri">https://news.ycombinator.com/item?id=7958388</a></li>
</ul>

  </div>

</div>

<div id="ArticleSourceCode">

<a href="posts/loading_nix-env_automatically.mdwn" title="posts\loading_nix-env_automatically.mdwn">article source</a>
</div>

</div>

<div id="scrollUp">
<span id="scrollUpBtn" class="glyphiconLink glyphicon glyphicon-chevron-up" aria-hidden="true" title="scroll up"></span>
</div>

<script>
$("#scrollUpBtn").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});
</script>


<script>
window.onload = function(e){
  anchors.add('h1')
  anchors.add('h2')
  anchors.add('h3')
  anchors.add('h4')
  anchors.add('h5')
}
</script>




<script>
$(document).ready(function() {
  //Calls the tocify method on your HTML div.
  $("#toc").tocify();
});
$("#toc").hover(function() {
  $("#toc").css("z-index", "111")
}, function() {
  $("#toc").css("z-index", "1")
});
</script>



<script>

var shifted = false;

$(window).keyup(function(event) {
    shifted = event.shiftKey;
});

$(window).keydown(function(event) {
  if(event.keyCode == 16){
    shifted = event.shiftKey;
  }
  if (shifted == false) {
      if(event.keyCode == 37){
        $('.glyphicon-chevron-left')[0].click()
      }
      if(event.keyCode == 39){
        $('.glyphicon-chevron-right')[0].click()
      }
  }
});
</script>


<script>
// check if we got served from pankat-server
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
  if (xhr.status == 200) {
    console.log("request to /pankat-server returned status: " + xhr.status + ", so yes we got served from pankat-server");
    $('#draft').css("display", "block");
    $('#roadmap').css("display", "block");
  }
}
}
xhr.open('GET', "/pankat-server", false);
xhr.send(null);
</script>
</body>
</html>
